<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="utf-8">
    <title>jQuery and Bootstrap Test</title>
    
    <!-- jQuery - Load early to ensure availability -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" 
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" 
        crossorigin="anonymous">
    </script>

    <!-- blurhash - load conditionally to avoid module errors -->
    <script>
        // Only load blurhash if we're in a proper browser context
        try {
            // Check if we're in a browser context and blurhash isn't already loaded
            if (typeof window !== 'undefined' && typeof window.BlurHash === 'undefined') {
                // Store original values
                const originalModule = window.module;
                const originalExports = window.exports;
                
                // Create a temporary module environment for the library
                window.module = { exports: {} };
                window.exports = window.module.exports;
                
                // Load the script dynamically
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/blurhash@2.0.5/dist/index.min.js';
                script.async = true;
                script.onload = function() {
                    // Extract the blurhash functions from module.exports and make them globally available
                    if (window.module && window.module.exports) {
                        window.BlurHash = window.module.exports;
                        // Also expose individual functions globally for easier access
                        if (window.module.exports.decode) {
                            window.decode = window.module.exports.decode;
                        }
                        if (window.module.exports.encode) {
                            window.encode = window.module.exports.encode;
                        }
                    }
                    
                    // Restore original values
                    if (originalModule !== undefined) {
                        window.module = originalModule;
                    } else {
                        delete window.module;
                    }
                    if (originalExports !== undefined) {
                        window.exports = originalExports;
                    } else {
                        delete window.exports;
                    }
                    
                    console.log('✅ BlurHash loaded successfully');
                };
                script.onerror = function() {
                    console.warn('BlurHash library failed to load - image lazy loading may not work optimally');
                    // Restore original values on error too
                    if (originalModule !== undefined) {
                        window.module = originalModule;
                    } else {
                        delete window.module;
                    }
                    if (originalExports !== undefined) {
                        window.exports = originalExports;
                    } else {
                        delete window.exports;
                    }
                };
                document.head.appendChild(script);
            }
        } catch (e) {
            console.warn('BlurHash loading skipped due to compatibility issues:', e);
        }
    </script>
</head>
<body>
    <div class="container mt-5">
        <h1>jQuery, Bootstrap, and BlurHash Test</h1>
        <p>This page tests if all libraries load without errors.</p>
        
        <div class="alert alert-info" role="alert">
            Testing libraries...
        </div>
        
        <!-- Bootstrap Dropdown Test -->
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                Bootstrap Dropdown Test
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
            </ul>
        </div>
    </div>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Bundle JS (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" 
        crossorigin="anonymous">
    </script>
    
    <!-- Test jQuery and Bootstrap -->
    <script>
        $(document).ready(() => {
            console.log('✅ jQuery is working!');
            $('.alert-info').removeClass('alert-info').addClass('alert-success').text('✅ jQuery loaded successfully!');
            
            // Test Bootstrap
            if (typeof bootstrap !== 'undefined') {
                console.log('✅ Bootstrap is working!');
                $('body').append('<div class="alert alert-success mt-3">✅ Bootstrap loaded successfully!</div>');
            } else {
                console.error('❌ Bootstrap failed to load');
                $('body').append('<div class="alert alert-danger mt-3">❌ Bootstrap failed to load</div>');
            }
        });
    </script>
</body>
</html>
