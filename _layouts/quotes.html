<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">

    <!-- Allows control over where resources are loaded from. Place as early in the document as possible, only applies to content below this tag. -->
    <!--<meta http-equiv="Content-Security-Policy" content="default-src 'self'">-->

    {% include calculate-variables.html %}

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <!-- IndieAuth and WebMentions Metadata -->
    {% include indieauth-and-webmentions-metadata.html %}

    <!-- SEO Metadata -->
    {% include meta-data-seo.html %}

    <!-- PWA Header Includes -->
    {% include pwa-header-includes.html %}

    <!-- News Feed Meta Tags. -->
    {% include feeds.html %}

    <!-- All CSS -->
    <!-- START OF CSS INCLUDE -->

    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" 
          integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
          crossorigin="anonymous">

    <!-- TODO: Add Dark Mode Back -->

    <!-- Custom CSS -->
    {% if full-page-url == home-page-url or full-page-url == "https://tedt.org/bootstrap4-index.html"%}
    <link rel="stylesheet"
          href="css/bootstrap4-landing-page.css">
    <link rel="stylesheet"
          href="{{site.siteurl}}/css/web-mention.css">
    {% else %}    
    <link rel="stylesheet"
          href="{{site.siteurl}}/css/blog-post.css">
    <link rel="stylesheet"
          href="{{site.siteurl}}/css/web-mention.css">
    <link rel="stylesheet"
          href="{{site.siteurl}}/css/webmention.css" >
    <link rel="stylesheet"
          href="{{site.siteurl}}/css/solarized-dark.css" >
    {% endif %}
    <!-- END OF CSS INCLUDE -->

    <!-- Custom Fonts -->
    {% include js-fontawsome.html %}

    {% if this_is_a_draft == true %}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredericka+the+Great&display=swap" rel="stylesheet">
    {% endif %}

    <!-- Scripts that need to be at the end of the header -->
    {% include scripts.html %}

  </head>

  <body>
    <!-- Legacy Browser Redirect & Google Tag Manager -->
    {% include top-of-body.html %}

    {% include bootstrap4-navigation.html %}

    <!-- Page Content -->
    <div class="container">
        <div class="row">
            <!-- Blog Post Content Column -->
            <div class="col-lg-8">
                <!-- Blog Post -->
                <article class="h-entry">
                    <!-- Title -->
                    <!-- First get the first 7 words of the Content -->

                    {% assign plainText = page.content | strip_html | strip_newlines %}
                    {% assign stringWithoutCommas = plainText | replace: ',', '' %}
                    {% assign wordstoconvert = stringWithoutCommas | split: ' ' %}
                    {% assign first_7_words = wordstoconvert | slice: 0, 7 %}

                    <!-- Calculate Title Case per NYT -->

                    {% assign lowercaseWords = "a,an,the,and,but,or,nor,for,so,yet,at,by,in,of,on,to,up,about,across,after,along,amid,around,as,before,behind,below,beside,between,beyond,during,except,from,inside,into,like,near,off,on,onto,out,outside,over,past,through,throughout,till,toward,under,underneath,until,unto,upon,with,within,without" | split: ',' %}

                    {% assign words = first_7_words | downcase | split: ' ' %}
                    {% assign WordsInTitle = first_7_words | downcase | split: ' ' %}

                    
                    {% for word in words %}
                        {% assign titleCaseWord = word | capitalize %}

                        {% if lowercaseWords contains word %}
                            {% assign titleCaseWord = word %}
                        {% endif %}

                        {% if forloop.first == true %}
                            {% assign titleCaseWord = word | capitalize %}
                        {% endif %}

                        {% if forloop.last == true %}
                            {% assign titleCaseWord = word | capitalize %}
                        {% endif %}

                        {% assign WordsInTitle[forloop.index0] = titleCaseWord %}
                    {% endfor %}

                    {% assign titleCaseString = WordsInTitle | join: ' ' %}


                    <hr>
                    {% include publish-and-update-date-time-v2.html %}
                    <i class="fa fa-th-large" aria-hidden="true"></i>&nbsp;Catagories:
                    {% assign categories = page.categories %}
                    {% for category in categories %}<span class="p-category">
                        {% capture thiscategory %}{{ category | strip }}{% endcapture %}
                        {% if forloop.length == 1 %}
                            {{thiscategory}}
                        {% elsif forloop.last and forloop.length == 2 %}
                            and {{thiscategory}}
                        {% elsif forloop.last %}
                            and {{thiscategory}}
                        {% else %}
                            {{thiscategory}}, 
                        {% endif %}
                        {% if thiscategory == "draft" or thiscategory == "Draft" %}
                            {% assign this_is_a_draft = true %}
                        {% endif %}</span>
                    {% endfor %}</br>
                    <hr>

                    {% if page.source-url %}
                        <h1 class="p-name"><a href="{{page.source-url}}" target="_new">{{ page.source }}</a>&NonBreakingSpace;<a href="{{page.source-url}}" target="_new"><i class="fa fa-external-link" aria-hidden="true"></i></a></h1>
                    {% elsif page.source %}
                        <h1 class="p-name">{{ page.source }}</h1>
                    {% else %}
                        <h1 class="p-name">Source: Unknown</h1>
                    {% endif %}

                    <h3><u>{{ page.author }}</u></h3> 

                    {% if page.image %}
                    <figure>
                    <img class="img-responsive img-thumbnail" src="{{site.siteurl}}{{ page.image }}" alt="{{page.image_alt}} by {{page.image_credits}}">
                      <figcaption>
                        {% if page.image-credits-URL or page.image-credits-title %}
                            <a target="_new" href="{{page.image-credits-URL}}">"{{page.image-credits-title}}" by {{page.image-credits-artist}}</a>
                        {% elsif page.image-credits %}
                          {{page.image_alt}} by {{page.image_credits}}
                        {% else %}
                            Unknown
                        {% endif %}
                      </figcaption>
                    </figure>
                    <hr>
                    {% endif %}


                    <!-- Post Content -->
                    <span class="e-content">
                        <style>
                            /* The link is a Dave Winer Link */
                            .Winerlink {
                                cursor: pointer;
                                display: inline;
                                height: auto;
                                line-height: 30px;
                                text-decoration: none;
                                text-decoration-line: none;
                                width: auto;
                                float: right
                            }
                            .WinerAnchor {
                                /* So as to ensure that its not at the top of the page where menu bars might be on top of it*/
                                scroll-margin-top: 100px;
                            }
                        </style>
    
                        <!-- Post Content -->
                        <script>
                            function addAnchorTagsToParagraphs(html) {
                            const parser = new DOMParser();
                            const doc = parser.parseFromString(html, "text/html");
                            const paragraphs = doc.querySelectorAll("p");
    
                            paragraphs.forEach((paragraph) => {
                                const paragraphText = paragraph.textContent.trim();
                                const words = paragraphText.split(" ");
                                const firstFiveWords = words.slice(0, 5).join(" ");
                                const firstFiveLetters = concatenateFirstLetters(firstFiveWords);
    
                                // Create the opening anchor tag
                                const openingAnchor = doc.createElement("a");
                                openingAnchor.classList.add("WinerAnchor");
                                openingAnchor.id = firstFiveLetters;
                                openingAnchor.name = firstFiveLetters;
                                paragraph.insertBefore(openingAnchor, paragraph.firstChild);
    
                                // Create the closing anchor tag
                                const closingAnchor = doc.createElement("a");
                                closingAnchor.href = `#`+firstFiveLetters;
                                closingAnchor.textContent = `Â¶`;
                                closingAnchor.classList.add("Winerlink");
                                paragraph.appendChild(closingAnchor);
                            });
    
                            return doc.documentElement.innerHTML;
                            }
    
                            function concatenateFirstLetters(text) {
                                const words = text.split(" ");
                                const firstFiveWords = words.slice(0, 5);
                                const firstLetters = firstFiveWords.map(word => word.charAt(0).toUpperCase());
                                
                                while (firstLetters.length < 5) {
                                    // Add a null character to the array in the event that there are less than 5 words.  Not the best, but it should work.
                                    firstLetters.push('â');
                                }
                                
                                const concatenatedLetters = firstLetters.join("").toLowerCase();
    
                                return concatenatedLetters;
                            }
                        </script>
    
                        <span class="e-content" id="main_content">{{ page.content }}</span>
    
                        <script>
                            var main_content = document.getElementById('main_content');
                            main_content.innerHTML = addAnchorTagsToParagraphs(main_content.innerHTML);
                        </script>
                    <hr>
                </article>

                <!--Next and Previous Articles -->
                {% include next_and_previous.html %}

                <hr>

            </div>

            <!-- Blog Sidebar Widgets Column -->
            <div class="col-md-4">

                <!-- TODO: Google Custom Search -->
                <!-- Blog Search Well -->
                <div class="well">
                    <h4>Blog Search</h4>
                    {% include google-search.html %}
                </div>

                <!-- Blog Categories Well -->
                <div class="well">
                    <div class="post-categories">
                        {% assign categories = page.categories %}
                        {% for category in categories %}
                            <h4>Latest in <a href="{{site.siteurl}}/category/{{category|slugize}}">{{category}}</a></h4>
                                <div class="row">
                                <div class="col-lg-12">
                                    <ul lass="list-unstyled">
                                        {% for post in site.categories[category] limit:5 %}
                                        <li><a href="{{site.siteurl}}{{ post.url }}">{{ post.title }}</a></li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

        </div>

    </div>
    <!-- /.container -->



  <!-- Footer -->
    <footer class="footer bg-light">
      <div class="container">
        <div class="row">
          <div class="col-lg-4 h-100 text-center text-lg-left my-auto">
            <ul class="list-inline mb-2">
              <li class="list-inline-item">
                <a href="https://tedt.org/">Home</a>
              </li>
              <li class="list-inline-item">&sdot;</li>
              <li class="list-inline-item">
                <a href="https://tedt.org/#about">About</a>
              </li>
              <li class="list-inline-item">&sdot;</li>
              <li class="list-inline-item">
                <a href="https://tedt.org/#contact">Contact</a>
              </li>
              <!--
              <li class="list-inline-item">&sdot;</li>
              <li class="list-inline-item">
                <a href="#">Terms of Use</a>
              </li> -->
              <li class="list-inline-item">&sdot;</li>
              <li class="list-inline-item">
                <a href="https://tedt.org/1993/01/01/privacy-policy/">Privacy Policy</a>
              </li>
            </ul>
            <p class="text-muted small mb-4 mb-lg-0">Copyright &copy; Ted Tschopp <script>document.write(new Date().getFullYear())</script>. All Rights Reserved</p>
          </div>
          <div class="col-lg-8 h-100 text-center text-lg-right my-auto">
           {% if site.github_username or
                  site.linkedin_username or
                  site.mastadon_username or
                  site.youtube_username or
                  site.reddit_username or
                  site.indiewebcamp_username or
                  site.quora_username %}
            <ul class="list-inline mb-0">
              {% if site.github_username %}
              <li class="list-inline-item mr-3">
                  <a href="https://github.com/{{ site.github_username }}/" rel="me"><i class="fab fa-github fa-lg fa-fw"></i></a>
              </li>
              {% else %}
              {% endif %}
              {% if site.linkedin_username %}
              <li class="list-inline-item mr-3">
                  <a href="https://www.linkedin.com/in/{{ site.linkedin_username }}/" rel="me"><i class="fab fa-linkedin fa-lg fa-fw"></i></a>
              </li>
              {% else %}
              {% endif %}
              {% if site.mastadon_username %}
              <li class="list-inline-item mr-3">
                {% assign mastadon_strings = site.mastadon_username | split: "@" %}
                <a href="https://{{mastadon_strings[1]}}/@{{mastadon_strings[0]}}" rel="me"><i class="fa-brands fa-mastodon"></i></a>
              </li>
              {% else %}
              {% endif %}
              {% if site.youtube_username %}
              <li class="list-inline-item mr-3">
                  <a href="https://www.youtube.com/user/{{ site.youtube_username }}/" rel="me"><i class="fab fa-youtube fa-lg fa-fw"></i></a>
              </li>
              {% else %}
              {% endif %}
              {% if site.reddit_username %}
              <li class="list-inline-item mr-3">
                  <a href="https://www.reddit.com/user/{{ site.reddit_username }}/" rel="me"><i class="fab fa-reddit fa-lg fa-fw"></i></a>
              </li>
              {% else %}
              {% endif %}
              {% if site.quora_username %}
              <li class="list-inline-item mr-3">
                  <a href="https://www.quora.com/profile/{{ site.quora_username }}/" rel="me"><i class="fab fa-quora fa-lg fa-fw"></i></a>
              </li>
              {% else %}
              {% endif %}
              {% if site.indiewebcamp_username %}
              <li class="list-inline-item mr-3">
                  <a href="https://indieweb.org/User:{{ site.indiewebcamp_username }}/" rel="me"><i class="fas fa-external-link-alt fa-lg fa-fw"></i></a>
              </li>
              {% else %}
              {% endif %}
              <li class="list-inline-item">
                <a href="{{ site.siteurl }}" rel="me" >
                  <i class="fas fa-home fa-lg fa-fw"></i>
                </a>
              </li>
            </ul>
            {% endif %}
          </div>
        </div>
      </div>
    </footer>



  </body>

</html>
