<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="utf-8">

    {% include utility/calculate-variables.html %}

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <!-- IndieAuth and WebMentions Metadata -->
    {% include seo/indieauth-webmentions-metadata.html %}

    <!-- SEO Metadata -->
    {% include seo/meta-data-seo.html %}

    <!-- PWA Header Includes -->
    {% include pwa/pwa-header-includes.html %}

    <!-- News Feed Meta Tags -->
    {% include feeds/feeds.html %}

    <!-- START OF CSS INCLUDE -->
    {% include assets/all-css-includes.html %}
    <!-- END OF CSS INCLUDE -->

    <link rel="stylesheet" type="text/css" href="{{ '/css/main-landing-page.css' | relative_url }}">

    <style>
      h1, .h1 { 
        font-family: "Sofia Sans Extra Condensed", "Optima", "ManukaCondensed", "Manuka", "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-weight: 600;
        letter-spacing: -3px;
        font-size: 60px;
        font-stretch: extra-condensed;
      }
      a { 
        text-decoration: underline;
        text-decoration-thickness: 1px;
      }
      a:hover, a:focus { 
        text-decoration: underline;
        text-decoration-thickness: 3px;
      }
    </style>

    <!-- Scripts that need to be at the end of the header -->
    {% include assets/scripts.html %}

    {% include utility/theme-debug-style.html %}
  </head>
  <body style="scroll-padding-top: 70px;" data-bs-spy="scroll" data-bs-target="#navbarNavDarkDropdown" data-bs-offset="70">

    {% include layout/top-nav-bar.html %}

    <main class="homepage--hero-morph">
      <!-- Hero Container that morphs on scroll -->
      <section class="hero-morph-section">
        <div class="hero-morph-container">
          {% include homepage/hero-random.html %}
          <div class="hero-morph-overlay">
            <h1>tedt.org</h1>
            <p>Exploring Technology, Theology & Imagination</p>
          </div>
        </div>
      </section>

      <!-- Categories Grid (appears as hero morphs) -->
      <div class="category-grid-container">
        <h2 style="text-align: center; margin-bottom: 3rem;">Explore Categories</h2>
        
        <div class="category-grid">
          {%- assign registry = site.data.category_registry -%}
          {%- assign cat_items = '' | split: '' -%}

          {%- for pair in registry -%}
            {%- assign slug = pair[0] | to_s | strip -%}
            {%- assign entry = pair[1] -%}
            {%- if slug == '' or entry.hide_from_carousel == true or entry.hide_from_carousel == 'true' -%}{%- continue -%}{%- endif -%}

            {%- assign has_posts = false -%}
            {%- assign _fallback_recent = site.posts | safe_sort: 'date' | reverse | slice: 0, 60 -%}
            {%- assign _cached_recent = site.config.recent_by_category[slug] | default: site.config.recent_by_category[entry.title] -%}
            {%- assign _scan_set = _cached_recent | default: _fallback_recent -%}

            {%- for p in _scan_set -%}
              {%- if p.path contains '_posts/Prompts/' or p.layout contains 'prompt' or p.categories contains 'Prompts' -%}{%- continue -%}{%- endif -%}
              {%- assign matched = false -%}
              {%- if p.categories contains entry.title -%}{%- assign matched = true -%}{%- endif -%}
              {%- if matched == false and p.categories contains slug -%}{%- assign matched = true -%}{%- endif -%}
              {%- if matched == false and entry.raw_names -%}
                {%- for rn in entry.raw_names -%}
                  {%- if p.categories contains rn -%}{%- assign matched = true -%}{%- break -%}{%- endif -%}
                {%- endfor -%}
              {%- endif -%}
              {%- if matched -%}{%- assign has_posts = true -%}{%- break -%}{%- endif -%}
            {%- endfor -%}

            {%- if has_posts -%}
              {%- assign title_for_sort = entry.label | default: entry.title | default: slug -%}
              {%- assign composite = slug | append: '||' | append: title_for_sort -%}
              {%- assign cat_items = cat_items | push: composite -%}
            {%- endif -%}
          {%- endfor -%}

          {%- assign cat_items = cat_items | safe_sort | sort_natural -%}

          {%- for composite in cat_items -%}
            {%- assign parts = composite | split: '||' -%}
            {%- assign slug = parts[0] -%}
            {%- assign entry = registry[slug] -%}
            {%- assign category_data_title = entry.title -%}
            {%- assign category_data_subtitle = entry.subtitle -%}
            {%- assign category_data_description = entry.description -%}

            {%- if entry.category_home_page -%}
              {%- assign category_href = entry.category_home_page -%}
            {%- else -%}
              {%- assign category_href = '/category/' | append: slug | append: '/' -%}
            {%- endif -%}

            <!-- Dynamic category variables: set CSS custom properties for theming -->
            {%- assign palette = entry.palette -%}
            {%- if palette -%}
              {%- assign start_color = palette.start | default: palette.gradient_start | default: '#f8f6f0' -%}
              {%- assign end_color = palette.end | default: palette.gradient_end | default: '#e8e6e0' -%}
              {%- assign accent_color = palette.accent | default: palette.titleColor | default: '#00446f' -%}
            {%- else -%}
              {%- assign start_color = '#f8f6f0' -%}
              {%- assign end_color = '#e8e6e0' -%}
              {%- assign accent_color = '#00446f' -%}
            {%- endif -%}

            <div class="category-morph-card" style="--theme-gradient-start: {{ start_color }}; --theme-gradient-end: {{ end_color }}; --theme-accent: {{ accent_color }};">
              <div class="category-emoji">{{ entry.emoji | default: 'ðŸ“Œ' }}</div>
              <h3 class="category-title"><a href="{{ category_href }}" style="text-decoration: none; color: inherit;">{{ entry.label | default: entry.title | default: slug }}</a></h3>
              <p style="margin: 0.5rem 0; opacity: 0.8;">{{ category_data_description | default: category_data_subtitle }}</p>

              <div class="recent-posts">
                {%- assign _recent_cat_posts = site.config.recent_by_category[slug] | default: site.config.recent_by_category[entry.title] -%}
                {%- if _recent_cat_posts == nil -%}
                  {%- assign _recent_cat_posts = site.posts | safe_sort: 'date' | reverse | slice: 0, 30 -%}
                {%- endif -%}
                {%- assign post_count = 0 -%}
                {%- for post in _recent_cat_posts -%}
                  {%- if post.path contains '_posts/Prompts/' or post.layout contains 'prompt' or post.categories contains 'Prompts' -%}{%- continue -%}{%- endif -%}
                  {%- if post_count >= 3 -%}{%- break -%}{%- endif -%}
                  {%- assign matched = false -%}
                  {%- if post.categories contains entry.title -%}{%- assign matched = true -%}{%- endif -%}
                  {%- if matched == false and post.categories contains slug -%}{%- assign matched = true -%}{%- endif -%}
                  {%- if matched == false and entry.raw_names -%}
                    {%- for rn in entry.raw_names -%}
                      {%- if post.categories contains rn -%}{%- assign matched = true -%}{%- break -%}{%- endif -%}
                    {%- endfor -%}
                  {%- endif -%}
                  {%- if matched -%}
                    {%- assign post_count = post_count | plus: 1 -%}
                    <div class="post-item"><a href="{{ post.url | absolute_url }}">{{ post.title }}</a></div>
                  {%- endif -%}
                {%- endfor -%}
              </div>
            </div>
          {%- endfor -%}
        </div>
      </div>

      <!-- Recent Blog Posts Section -->
      <div class="container py-4 py-xl-5" style="margin-top: 4rem; background: #f8f6f0; padding: 3rem 1rem;">
        <div class="row gy-4">
          <div class="col-12">
            <h2 style="text-align: center; margin-bottom: 3rem;">Latest Articles</h2>
          </div>
          {%- assign count = 0 -%}
          {%- assign _blog_candidates = site.config.recent_by_category.blog | default: site.posts | safe_sort: 'date' | reverse -%}
          {%- for post in _blog_candidates -%}
            {%- if post.categories contains "Bestiary" or post.categories contains "Draft" or post.categories contains "Role Playing Games" or post.categories contains "Folklore" or post.categories contains "Quotes" or post.categories contains "Home" or post.layout contains "micropubpost" or post.layout contains "gammaworld" or post.categories contains "Prompts" or post.layout contains "prompt" or post.path contains "_posts/Prompts/" -%}{%- continue -%}{%- endif -%}

            {%- assign count = count | plus: 1 -%}
            {%- if count > 6 -%}{%- break -%}{%- endif -%}

            <div class="col-12 col-md-6 col-lg-4">
              <div class="card h-100">
                {%- if post.image -%}
                  {%- assign image_alt = post.image-alt | default: post.image-description | default: post.title -%}
                  {%- assign _image_raw = post.image | strip -%}
                  {%- assign _image_first = _image_raw | slice: 0, 1 -%}
                  {%- assign _image_first2 = _image_raw | slice: 0, 2 -%}
                  {%- if _image_raw contains '://' or _image_first2 == '//' or _image_first == '/' -%}
                    {%- assign image_URL = _image_raw -%}
                  {%- else -%}
                    {%- assign image_URL = '/' | append: _image_raw -%}
                  {%- endif -%}
                  <img src="{{ image_URL }}" alt="{{ image_alt }}" class="card-img-top" style="height: 200px; object-fit: cover;" loading="lazy">
                {%- endif -%}
                <div class="card-body">
                  <h5 class="card-title"><a href="{{ post.url | absolute_url }}">{{ post.title }}</a></h5>
                  <p class="card-text text-muted small">
                    {%- assign __summary = post.teaser | default: post.description | default: post.excerpt -%}
                    {%- if __summary == nil or __summary == '' -%}
                      {%- assign __summary = post.content | strip_html | truncate: 120 -%}
                    {%- endif -%}
                    {{ __summary | strip_html }}
                  </p>
                </div>
              </div>
            </div>
          {%- endfor -%}
        </div>
      </div>
    </main>

    {% include layout/footer.html %}
    {% include assets/end-of-body-assets.html %}
    <script src="{{ '/js/homepage-animations.js' | relative_url }}"></script>
  </body>
</html>
