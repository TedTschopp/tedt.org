<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="utf-8">

    {% include utility/calculate-variables.html %}

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <!-- IndieAuth and WebMentions Metadata -->
    {% include seo/indieauth-webmentions-metadata.html %}

    <!-- SEO Metadata -->
    {% include seo/meta-data-seo.html %}

    <!-- PWA Header Includes -->
    {% include pwa/pwa-header-includes.html %}

    <!-- News Feed Meta Tags -->
    {% include feeds/feeds.html %}

    <!-- START OF CSS INCLUDE -->
    {% include assets/all-css-includes.html %}
    <!-- END OF CSS INCLUDE -->
    {% capture __math_flag %}{{ page.math | default: '' }}{% endcapture %}
    {% capture __mathjax_flag %}{{ page.mathjax | default: '' }}{% endcapture %}
    {% assign __math_flag = __math_flag | strip | downcase %}
    {% assign __mathjax_flag = __mathjax_flag | strip | downcase %}
    {% if page.math == true or __math_flag == 'true' or __math_flag == '1' or page.mathjax == true or __mathjax_flag == 'true' or __mathjax_flag == '1' %}
      {% include assets/mathjax.html %}
    {% endif %}

      <style>
        /* Dynamic category title colors */
        [data-bs-theme="light"] .cat-dynamic-title,
        [data-bs-theme="light"] .cat-dynamic-title a,
        [data-bs-theme="light"] .cat-dynamic-title a:visited {
          color: var(--cat-title-color-light, var(--cat-title-color-dark, inherit));
        }
        [data-bs-theme="dark"] .cat-dynamic-title,
        [data-bs-theme="dark"] .cat-dynamic-title a,
        [data-bs-theme="dark"] .cat-dynamic-title a:visited {
          color: var(--cat-title-color-dark, var(--cat-title-color-light, inherit));
        }
        [data-bs-theme="light"] .cat-dynamic-title a:hover { color: var(--cat-title-hover-color-light, var(--cat-title-color-light, inherit)); }
        [data-bs-theme="dark"] .cat-dynamic-title a:hover { color: var(--cat-title-hover-color-dark, var(--cat-title-color-dark, inherit)); }

        /* Homepage post bullets: semantic list with centered custom dot */
        .post-bullets { list-style: none; margin: 0; padding: 0; }
        .post-bullets .post-bullet-item { display: flex; align-items: center; gap: .6rem; margin: .5rem 0 .5rem 0; font-size: smaller;}
        .post-bullets .post-bullet-item:last-child { margin-bottom: 0; }
        .post-bullet-dot { width: .45rem; height: .45rem; border-radius: 50%; background: currentColor; flex: 0 0 .45rem; }
        [data-bs-theme="dark"] .post-bullet-dot { opacity: .85; }
        .post-bullet-text { line-height: 1.25; }
      </style>

      <!-- Scripts that need to be at the end of the header -->
      {% include assets/scripts.html %}
      <script>
        // Early theme initialization (moved to head for minimal FOUC) (Item C)
        (function(){
          try {
            const cookie = document.cookie.match(/(?:^|; )site_theme=([^;]+)/);
            let pref = cookie ? decodeURIComponent(cookie[1]) : 'auto';
            if(!['light','dark','auto'].includes(pref)) pref = 'auto';
            const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const mode = pref === 'auto' ? (systemDark ? 'dark':'light') : pref;
            document.documentElement.setAttribute('data-bs-theme', mode);
          } catch(e){}
        })();
      </script>
  <body style="scroll-padding-top: 70px;" data-bs-spy="scroll" data-bs-target="#navbarNavDarkDropdown" data-bs-offset="70">

    {% include layout/top-nav-bar.html %}

    {% include homepage/hero-random.html %}

    <div class="container py-4 py-xl-5">
      <section>
        <div class="container h-100">
          <div class="row gy-5 gy-lg-0 row-cols-1 row-cols-md-2 row-cols-lg-3">
            <div class="col">
              <div class="card h-100">
                <div class="ratio ratio-3x1">
                  <img class="card-img-top w-100 d-block img-fluid rounded-start object-fit-cover" alt="Ted sitting at a computer in Nature" src="{{ site.url }}/img/home/blog.webp" />
                </div>
                <div class="card-body pt-2 pb-2 p-4">
                  {%- assign __blog_slug = 'blog' -%}
                  {%- assign __blog_entry = site.data.category_registry[__blog_slug] -%}
                  {%- if __blog_entry and __blog_entry.category_home_page -%}
                    <h2 class="card-title cat-dynamic-title" id="blog">
                      {% include utility/category-label.html category='blog' href=__blog_entry.category_home_page kind='title' class_extra='text-decoration-none' %}
                    </h2>
                  {%- else -%}
                    <h2 class="card-title cat-dynamic-title" id="blog">
                      {% include utility/category-label.html category='blog' kind='title' class_extra='text-decoration-none' %}
                    </h2>
                  {%- endif -%}
                  <h3 class="text-muted card-subtitle mb-2 three-line-clamp">Exploring the Intersection of Tech, Theology, and Imagination</h3>
                  <p class="card-text three-line-clamp">This blog is my journey exploring technology, theology, and creativity, where I talk about religion in the digital age, trends in UI/UX, collaboration tools, and storytelling.</p>
                </div>
                <div class="card-footer p-0 py-0 h-100">
                  {% assign count = 0 %}
                  {%- comment -%}
                    Use precomputed recent_by_category cache instead of iterating site.posts.
                    Fallback: slice newest posts if cache missing.
                  {%- endcomment -%}
                  {% assign _blog_candidates = site.config.recent_by_category.blog | default: site.posts | safe_sort: 'date' | reverse %}
                  {% assign __shown_urls = '' | split: '' %}
                  {% for post in _blog_candidates %}
                    {% if post.categories contains "Bestiary" or post.category == "Bestiary" %}
                      <!-- Do Nothing -->
                    {% elsif post.categories contains "Draft" or post.category == "Draft" %}
                      <!-- Do Nothing -->
                    {% elsif post.categories contains "Role Playing Games" or post.category == "Role Playing Games" %}
                      <!-- Do Nothing -->
                    {% elsif post.categories contains "Folklore" or post.category == "Folklore" %}
                      <!-- Do Nothing -->
                    {% elsif post.categories contains "Quotes" or post.category == "Quote" or post.category == "quote" %}
                      <!-- Do Nothing -->
                    {% elsif post.categories contains "Home" or post.category == "Home" %}
                      <!-- Do Nothing -->
                    {% elsif post.layout contains "micropubpost" %}
                      <!-- Do Nothing -->
                    {% elsif post.layout contains "gammaworld" %}
                      <!-- Do Nothing -->
                    {% elsif post.layout contains "prompt" or post.category == "Prompts" %}
                      <!-- Do Nothing -->
                    {% else %}
                      {% assign count = count | plus: 1 %}
                      {% if count > 3 %}
                        {% break %}
                      {% endif %}
                      {%- comment -%} Track shown URLs to prevent duplicates in fallback scan {%- endcomment -%}
                      {% assign __shown_urls = __shown_urls | push: post.url %}

                      <div class="container">
                        <div class="row align-items-stretch">
                          {% if post.image %}
                            {% assign image_alt = post.image-alt | default: post.image-description | default: post.title %}
                            {% assign image_credits_title = post.image-credits-title | default: post.image-title | default: "Unknown" %}
                            {% assign image_credits = post.image-credits-artist | default: post.image-artist | default: "Unknown" %}
                            {% assign image_credits_artist_URL = post.image-credits-artist-URL | default: post.image-artist-URL %}
                            {% assign image_URL = post.image %}
                            <div class="card rounded-0 px-0">
                              <div class="row g-0">
                                <div class="col-md-4">
                                  <img src="{{ image_URL }}" alt="{{ image_alt }} by {{ image_credits }}" class="img-fluid rounded-start" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy">
                                </div>
                                <div class="col-md-8">
                                  <div class="card-body">
                                    <h5 class="card-title three-line-clamp">
                                      <a href="{{ post.url | absolute_url }}">{{ post.title }}</a>
                                    </h5>
                                    <p class="card-text text-truncate-5">
                                      {%- assign __summary = post.teaser | default: post.description | default: post.excerpt -%}
                                      {%- if __summary == nil or __summary == '' -%}
                                        {%- assign __summary = post.content | strip_html | truncate: 180 -%}
                                      {%- endif -%}
                                      {{ __summary | strip_html }}
                                    </p>
                                  </div>
                                </div>
                              </div>
                            </div>
                          {% else %}
                            <div class="card rounded-0 px-0">
                              <div class="row g-0">
                                <div class="col-md-12">
                                  <div class="card-body">
                                    <h5 class="card-title three-line-clamp">
                                      <a href="{{ post.url | absolute_url }}">{{ post.title }}</a>
                                    </h5>
                                    <p class="card-text text-truncate-5">
                                      {%- assign __summary = post.teaser | default: post.description | default: post.excerpt -%}
                                      {%- if __summary == nil or __summary == '' -%}
                                        {%- assign __summary = post.content | strip_html | truncate: 180 -%}
                                      {%- endif -%}
                                      {{ __summary | strip_html }}
                                    </p>
                                  </div>
                                </div>
                              </div>
                            </div>
                          {% endif %}
                        </div>
                      </div>
                    {% endif %}
                  {% endfor %}
                  {%- comment -%} If fewer than 3 posts were gathered from cached list, perform a broader scan across all posts to try to fill remaining slots. {%- endcomment -%}
                  {% if count < 3 %}
                    {% assign _all_candidates = site.posts | safe_sort: 'date' | reverse %}
                    {% for post in _all_candidates %}
                      {% if count >= 3 %}{% break %}{% endif %}
                      {%- assign __skip = false -%}
                      {%- if __shown_urls contains post.url -%}{%- assign __skip = true -%}{%- endif -%}
                      {% if __skip %}{% continue %}{% endif %}
                      {% if post.categories contains "Bestiary" or post.category == "Bestiary" %}
                        {% assign __skip = true %}
                      {% elsif post.categories contains "Draft" or post.category == "Draft" %}
                        {% assign __skip = true %}
                      {% elsif post.categories contains "Role Playing Games" or post.category == "Role Playing Games" %}
                        {% assign __skip = true %}
                      {% elsif post.categories contains "Folklore" or post.category == "Folklore" %}
                        {% assign __skip = true %}
                      {% elsif post.categories contains "Quotes" or post.category == "Quote" or post.category == "quote" %}
                        {% assign __skip = true %}
                      {% elsif post.categories contains "Home" or post.category == "Home" %}
                        {% assign __skip = true %}
                      {% elsif post.layout contains "micropubpost" %}
                        {% assign __skip = true %}
                      {% elsif post.layout contains "gammaworld" %}
                        {%- comment -%} Skip Gamma World layout posts (Bestiary style) on homepage blog list to avoid blank/irrelevant card. {%- endcomment -%}
                        {% assign __skip = true %}
                      {% elsif post.layout contains "prompt" or post.category == "Prompts" %}
                        {% assign __skip = true %}
                      {% endif %}
                      {% if __skip %}{% continue %}{% endif %}
                      {% assign count = count | plus: 1 %}
                      {% assign __shown_urls = __shown_urls | push: post.url %}
                      <div class="container">
                        <div class="row align-items-stretch">
                          {% if post.image %}
                            {% assign image_alt = post.image-alt | default: post.image-description | default: post.title %}
                            {% assign image_credits_title = post.image-credits-title | default: post.image-title | default: "Unknown" %}
                            {% assign image_credits = post.image-credits-artist | default: post.image-artist | default: "Unknown" %}
                            {% assign image_credits_artist_URL = post.image-credits-artist-URL | default: post.image-artist-URL %}
                            {% assign image_URL = post.image %}
                            <div class="card rounded-0 px-0">
                              <div class="row g-0">
                                <div class="col-md-4">
                                  <img src="{{ image_URL }}" alt="{{ image_alt }} by {{ image_credits }}" class="img-fluid rounded-start" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy">
                                </div>
                                <div class="col-md-8">
                                  <div class="card-body">
                                    <h5 class="card-title three-line-clamp">
                                      <a href="{{ post.url | absolute_url }}">{{ post.title }}</a>
                                    </h5>
                                    <p class="card-text text-truncate-5">
                                      {%- assign __summary = post.teaser | default: post.description | default: post.excerpt -%}
                                      {%- if __summary == nil or __summary == '' -%}
                                        {%- assign __summary = post.content | strip_html | truncate: 180 -%}
                                      {%- endif -%}
                                      {{ __summary | strip_html }}
                                    </p>
                                  </div>
                                </div>
                              </div>
                            </div>
                          {% else %}
                            <div class="card rounded-0 px-0">
                              <div class="row g-0">
                                <div class="col-md-12">
                                  <div class="card-body">
                                    <h5 class="card-title three-line-clamp">
                                      <a href="{{ post.url | absolute_url }}">{{ post.title }}</a>
                                    </h5>
                                    <p class="card-text text-truncate-5">
                                      {%- assign __summary = post.teaser | default: post.description | default: post.excerpt -%}
                                      {%- if __summary == nil or __summary == '' -%}
                                        {%- assign __summary = post.content | strip_html | truncate: 180 -%}
                                      {%- endif -%}
                                      {{ __summary | strip_html }}
                                    </p>
                                  </div>
                                </div>
                              </div>
                            </div>
                          {% endif %}
                        </div>
                      </div>
                    {% endfor %}
                  {% endif %}
                </div>
              </div>
            </div>

            <div class="col">
              <div class="card h-100">
                <div class="ratio ratio-3x1">
                  <img class="card-img-top w-100 d-block img-fluid rounded-start object-fit-cover" alt="Swiss Children Playing with a Doll" src="{{ site.url }}/img/home/Folklore.webp" />
                </div>
                <div class="card-body pt-2 pb-2 p-4">
                  {%- assign __folklore_slug = 'folklore' -%}
                  {%- assign __folklore_entry = site.data.category_registry[__folklore_slug] -%}
                  {%- if __folklore_entry and __folklore_entry.category_home_page -%}
                    <h2 class="card-title cat-dynamic-title" id="folklore">
                      {% include utility/category-label.html category='folklore' href=__folklore_entry.category_home_page kind='title' class_extra='text-decoration-none' text_override='Swiss Folklore' %}
                    </h2>
                  {%- else -%}
                    <h2 class="card-title cat-dynamic-title" id="folklore">
                      {% include utility/category-label.html category='folklore' kind='title' class_extra='text-decoration-none' text_override='Swiss Folklore' %}
                    </h2>
                  {%- endif -%}
                  <h3 class="text-muted card-subtitle mb-2 three-line-clamp">Whispers from the Alps: Navigating Swiss Folk Tales</h3>
                  <p class="card-text three-line-clamp">A collection of Swiss Folklore stories I am translating and posting here. I am using computer tools to do the translation work, so everything might not be 100% accurate.</p>
                </div>
                <div class="card-footer p-0 py-0 h-100">
                  {%- assign _folklore_raw = site.categories['Folklore'] -%}
                  {%- if _folklore_raw -%}
                    {%- assign folklore_posts = _folklore_raw | safe_sort: 'date' | reverse -%}
                  {%- else -%}
                    {%- assign folklore_posts = empty -%}
                  {%- endif -%}
                  {% assign _count = 0 %}
                  {% for post in folklore_posts %}
                    {% assign _count = _count | plus: 1 %}
                    {% if _count > 3 %}
                      {% break %}
                    {% endif %}

                    <div class="container">
                      <div class="row align-items-stretch">
                        {% if post.image %}
                          {% assign image_alt = post.image-alt | default: post.image-description | default: post.title %}
                          {% assign image_credits_title = post.image-credits-title | default: post.image-title | default: "Unknown" %}
                          {% assign image_credits = post.image-credits-artist | default: post.image-artist | default: "Unknown" %}
                          {% assign image_credits_artist_URL = post.image-credits-artist-URL | default: post.image-artist-URL %}
                          {% assign image_URL = post.image %}
                          <div class="card rounded-0 px-0">
                            <div class="row g-0">
                              <div class="col-md-4">
                                <img src="{{ image_URL }}" alt="{{ image_alt }} by {{ image_credits }}" class="img-fluid rounded-start" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy">
                              </div>
                              <div class="col-md-8">
                                <div class="card-body">
                                  <h5 class="card-title three-line-clamp">
                                    <a href="{{ post.url | absolute_url }}">{{ post.title }}</a>
                                  </h5>
                                  <p class="card-text text-truncate-5">
                                    {%- assign __summary = post.teaser | default: post.description | default: post.excerpt -%}
                                    {%- if __summary == nil or __summary == '' -%}
                                      {%- assign __summary = post.content | strip_html | truncate: 180 -%}
                                    {%- endif -%}
                                    {{ __summary | strip_html }}
                                  </p>
                                </div>
                              </div>
                            </div>
                          </div>
                        {% else %}
                          <div class="card rounded-0 px-0">
                            <div class="row g-0">
                              <div class="col-md-12">
                                <div class="card-body">
                                  <h5 class="card-title three-line-clamp">
                                    <a href="{{ post.url | absolute_url }}">{{ post.title }}</a>
                                  </h5>
                                  <p class="card-text text-truncate-5">
                                    {%- assign __summary = post.teaser | default: post.description | default: post.excerpt -%}
                                    {%- if __summary == nil or __summary == '' -%}
                                      {%- assign __summary = post.content | strip_html | truncate: 180 -%}
                                    {%- endif -%}
                                    {{ __summary | strip_html }}
                                  </p>
                                </div>
                              </div>
                            </div>
                          </div>
                        {% endif %}
                      </div>
                    </div>
                  {% endfor %}
                </div>
              </div>
            </div>
            {% include homepage/carousel.html %}
          </div>
        </div>
      </section>
    </div>
    <div class="container py-1 py-xl-2">
      <section>
        <div class="container h-100 position-relative">
          <div class="row mb-2 mb-lg-2">
            <div class="col-md-12 col-xl-10 text-center mx-auto">
              <h2 id="career">Career</h2>
              <p class="w-lg-75">As a Senior Enterprise Architect at Southern California Edison, I leverage over a decade of experience in guiding major stakeholders through complex tech landscapes, with past entrepreneurial successes including founding a prominent J.R.R. Tolkien community website and features in Wired Magazine, driven by a passion for pioneering futuristic technologies.</p>
            </div>
          </div>
        </div>
      </section>
    </div>

    <div class="container py-4 py-xl-5">
      <section>
        <div class="container h-100">
          <div class="row gy-5 gy-lg-0 row-cols-1">
            <div class="col">
              {%- assign _home_raw = site.categories['Home'] -%}
              {%- if _home_raw -%}
                {%- assign sorted_homepage = _home_raw | safe_sort: 'order' -%}
              {%- else -%}
                {%- assign sorted_homepage = empty -%}
              {%- endif -%}
              {% assign count = 0 %}
              {% assign previous_tag = '' %}
              {% for post in sorted_homepage %}
                {% assign count = count | plus: 1 %}
                {% assign mod = count | modulo: 2 %}
                {% for tag in post.tags %}
                  {% if post.company != blank and post.company != null %}
                    {% assign watermark = post.company | append: "-watermark" %}
                  {% else %}
                    {% assign watermark = "no-watermark" %}
                  {% endif %}

                  {% if tag == 'Resume' %}
                    {% assign this-post-title = post.title | append: ", " | append: post.location.name | append: " from " | append: post.start-date | append: " to " | append: post.stop-date %}
                  {% else %}
                    {% assign this-post-title = post.title %}
                  {% endif %}
                  {% if previous_tag == 'Resume' and tag != 'Resume' %}
                    <!-- Output some new content here -->
                    <div class="container py-1 py-xl-2">
                      <section>
                        <div class="container h-100 position-relative">
                          <div class="row mb-2 mb-lg-2">
                            <div class="col-md-12 col-xl-10 text-center mx-auto">
                              <h2 id="projects">Projects</h2>
                              <p class="w-lg-75">From the comprehensive redesign of Southern California Edison's intranet and corporate websites to leading the innovative Edison SmartConnect project and creating unique digital applications like procedurally generated star constellations, I blend my expertise in web technologies and solution engineering to deliver projects that reshape our digital landscape.</p>
                            </div>
                          </div>
                        </div>
                      </section>
                    </div>
                  {% endif %}
                  {% assign previous_tag = tag %}

                  <a name="{{ post.title | slugify}}" style="scroll-margin-top: 76px;"></a>
                  <div class="card mb-3">
                    <div class="row g-0 align-items-center">
                      {% if mod != 1 %}<!-- odd -->
                        <div class="col-md-4 d-flex align-items-center">
                          <img src="{{ site.url }}/{{post.image}}" class="img-fluid rounded-start" alt="{{post.image-credits-title}} by {{post.image-credits-artist}}">
                        </div>
                        <div class="col-md-8">
                          <div class="card-body align-items-center {{ watermark }}">
                            <h4 class="card-title">
                              {% if post.title-url and post.title-url != "" and post.title-url != nil %}
                                <a href="{{post.title-url}}" target="_blank" rel="noopener nofollow noreferrer">{{ this-post-title }}</a>
                              {% else %}
                                {{ this-post-title }}
                              {% endif %}
                            </h4>
                            <p class="card-text">{{ post.description}}</p>
                            {% if post.bullets and post.bullets.size > 0 %}
                              <div class="post-bullets" role="list">{%- for bullet in post.bullets -%}{%- assign __b = bullet | markdownify | replace_first: '<p>', '' | replace: '</p>', '' | strip -%}<div class="post-bullet-item" role="listitem"><span class="post-bullet-dot" aria-hidden="true"></span><span class="post-bullet-text">{{ __b | strip }}</span></div>{%- endfor -%}</div>
                            {% endif %}
                          </div>
                        </div>
                      {% else %}
                        <div class="col-md-8">
                          <div class="card-body align-items-center {{ watermark }}">
                            <h4 class="card-title">
                              {% if post.title-url and post.title-url != "" and post.title-url != nil %}
                                <a href="{{post.title-url}}" target="_blank" rel="noopener nofollow noreferrer">{{ this-post-title }}</a>
                              {% else %}
                                {{ this-post-title }}
                              {% endif %}
                            </h4>
                            <p class="card-text">{{ post.description}}</p>
                            {% if post.bullets and post.bullets.size > 0 %}
                              <div class="post-bullets" role="list">{%- for bullet in post.bullets -%}{%- assign __b = bullet | markdownify | replace_first: '<p>', '' | replace: '</p>', '' | strip -%}<div class="post-bullet-item" role="listitem"><span class="post-bullet-dot" aria-hidden="true"></span><span class="post-bullet-text">{{ __b | strip }}</span></div>{%- endfor -%}</div>
                            {% endif %}
                          </div>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                          <img src="{{ site.url }}/{{post.image}}" class="img-fluid rounded-start" alt="{{post.image-credits-title}} by {{post.image-credits-artist}}">
                        </div>
                      {% endif %}
                    </div>
                  </div>
                {% endfor %}
              {% endfor %}
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Footer -->
    {% include layout/footer.html %}

    <!-- Bootstrap core JavaScript -->
    {% include assets/js-bottom-of-body.html %}

    <script>
      // Random hero selection + image->video transition
      document.addEventListener('DOMContentLoaded', function() {
        const heroImg = document.getElementById('hero-img');
        const heroVideo = document.getElementById('hero-video');
        if (!heroImg || !heroVideo) return;

        // --- Random Hero Variant Selection ---
        // List of base filenames WITHOUT extension (must have matching .webp/.mp4 in folder)
        // To add a new hero: drop hero-<name>.webp & hero-<name>.mp4 into the folder and add 'hero-<name>' here.
        const HERO_FOLDER = '/img/categories/home-hero-images';
        const HERO_VARIANTS = [
          'hero-data-center',
          'hero-dice',
          'hero-digital-twin-power-grid',
          'hero-family',
          'hero-forest',
          'hero-hardware',
          'hero-lake',
          'hero-landscape',
          'hero-library',
          'hero-powerlines',
          'hero-village'
        ];

        // Pick one at random each page load
        const chosen = HERO_VARIANTS[Math.floor(Math.random() * HERO_VARIANTS.length)];
        const imgSrcWebp = `${HERO_FOLDER}/${chosen}.webp`;
        const videoSrcMp4 = `${HERO_FOLDER}/${chosen}.mp4`;

        // Derive a simple alt text from file name if not manually curated
        const altText = (function(file){
          try {
            let core = file.replace(/^hero-/, '').replace(/-/g, ' ');
            core = core.charAt(0).toUpperCase() + core.slice(1);
            return core + ' (hero image)';
          } catch(_) { return 'Homepage hero image'; }
        })(chosen);

        // Swap image source ASAP (keeps original as placeholder until this runs)
        heroImg.src = imgSrcWebp;
        heroImg.alt = altText;

        // Ensure the <source> inside the video uses the random variant
        let sourceEl = heroVideo.querySelector('source');
        if (!sourceEl) {
          sourceEl = document.createElement('source');
          heroVideo.appendChild(sourceEl);
        }
        sourceEl.setAttribute('src', videoSrcMp4);
        sourceEl.setAttribute('type', 'video/mp4');

        // Respect prefers-reduced-motion: skip autoplay video if user prefers less motion
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

        // --- Existing transition logic (slightly adapted) ---
        if (prefersReducedMotion) {
          // Don't auto-play video, keep static image
          heroVideo.parentElement && (heroVideo.parentElement.style.position = 'relative');
          heroVideo.style.display = 'none';
          return; // Exit early
        }

        window.addEventListener('load', function() {
          setTimeout(function() {
            heroVideo.style.display = 'block';
            heroVideo.style.opacity = '0';
            heroVideo.style.position = 'absolute';
            heroVideo.style.top = '0';
            heroVideo.style.left = '0';
            heroVideo.style.width = '100%';
            heroVideo.style.height = '100%';
            heroVideo.style.objectFit = 'cover';

            // (Re)load the newly assigned video source
            heroVideo.load();

            heroVideo.addEventListener('canplay', function() {
              heroVideo.play().then(function() {
                heroImg.style.transition = 'opacity 0.8s ease-in-out';
                heroVideo.style.transition = 'opacity 0.8s ease-in-out';
                setTimeout(function() {
                  heroImg.style.opacity = '0';
                  heroVideo.style.opacity = '1';
                }, 100);
              }).catch(function(error) {
                console.log('Video autoplay prevented:', error);
                heroVideo.style.display = 'none';
              });
            }, { once: true });

            // Fallback timeout
            setTimeout(function() {
              if (heroVideo.style.opacity === '0' || heroVideo.style.opacity === '') {
                console.log('Video load timeout, keeping image only');
                heroVideo.style.display = 'none';
              }
            }, 5000);
          }, 1500); // existing 1.5s delay
        });
      });

      // Random carousel start position with resilient Bootstrap init
      document.addEventListener('DOMContentLoaded', function() {
        const carousel = document.getElementById('carousel-of-all-blog-categories');
        if (!carousel) return;

        const carouselItems = carousel.querySelectorAll('.carousel-item');
        if (carouselItems.length === 0) return;

        // Generate random index
        const randomIndex = Math.floor(Math.random() * carouselItems.length);

        // Ensure only one active slide: remove any existing actives, then set random as active
        carouselItems.forEach((item, idx) => {
          if (idx === randomIndex) {
            item.classList.add('active');
            item.setAttribute('aria-current', 'true');
          } else {
            item.classList.remove('active');
            item.removeAttribute('aria-current');
          }
        });

        // Initialize Bootstrap carousel with retry until the script is available
        const tryInit = () => {
          try {
            const bs = window.bootstrap;
            if (!bs || typeof bs.Carousel !== 'function') return false;
            const instance = new bs.Carousel(carousel, { interval: 2000, ride: false });
            instance.to(randomIndex);
            return true;
          } catch (_) {
            return false;
          }
        };

        if (!tryInit()) {
          // Retry for a short period in case the CDN script finishes slightly later
          let attempts = 0;
          const maxAttempts = 50; // ~5 seconds at 100ms
          const timer = setInterval(() => {
            attempts++;
            if (tryInit() || attempts >= maxAttempts) {
              clearInterval(timer);
            }
          }, 100);
          // One more attempt on window load
          window.addEventListener('load', () => { tryInit(); }, { once: true });
        }
      });
    </script>

  </body>

  {% include utility/theme-debug.html %}

</html>