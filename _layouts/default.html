<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="utf-8">

    {% include utility/calculate-variables.html %}

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <!-- IndieAuth and WebMentions Metadata -->
    {% include seo/indieauth-webmentions-metadata.html %}

    <!-- SEO Metadata -->
    {% include seo/meta-data-seo.html %}

    <!-- PWA Header Includes -->
    {% include pwa/pwa-header-includes.html %}

    <!-- News Feed Meta Tags -->
    {% include feeds/feeds.html %}

    <!-- START OF CSS INCLUDE -->
    {% include assets/all-css-includes.html %}
    <!-- END OF CSS INCLUDE -->
    {% if page.math or page.mathjax %}
      {% include assets/mathjax.html %}
    {% endif %}

    <!-- WCAG contrast utility styles -->
    <link rel="stylesheet" href="/css/WCAG.css">
      <style>
        /* Dynamic category title colors */
        [data-bs-theme="light"] .cat-dynamic-title,
        [data-bs-theme="light"] .cat-dynamic-title a,
        [data-bs-theme="light"] .cat-dynamic-title a:visited {
          color: var(--cat-title-color-light, var(--cat-title-color-dark, inherit));
        }
        [data-bs-theme="dark"] .cat-dynamic-title,
        [data-bs-theme="dark"] .cat-dynamic-title a,
        [data-bs-theme="dark"] .cat-dynamic-title a:visited {
          color: var(--cat-title-color-dark, var(--cat-title-color-light, inherit));
        }
        [data-bs-theme="light"] .cat-dynamic-title a:hover { color: var(--cat-title-hover-color-light, var(--cat-title-color-light, inherit)); }
        [data-bs-theme="dark"] .cat-dynamic-title a:hover { color: var(--cat-title-hover-color-dark, var(--cat-title-color-dark, inherit)); }

        /* Homepage post bullets: semantic list with centered custom dot */
        .post-bullets { list-style: none; margin: 0; padding: 0; }
        .post-bullets .post-bullet-item { display: flex; align-items: center; gap: .6rem; margin: .5rem 0 .5rem 0; font-size: smaller;}
        .post-bullets .post-bullet-item:last-child { margin-bottom: 0; }
        .post-bullet-dot { width: .45rem; height: .45rem; border-radius: 50%; background: currentColor; flex: 0 0 .45rem; }
        [data-bs-theme="dark"] .post-bullet-dot { opacity: .85; }
        .post-bullet-text { line-height: 1.25; }
      </style>

      <!-- Scripts that need to be at the end of the header -->
      {% include assets/scripts.html %}
      <script>
        // Early theme initialization (moved to head for minimal FOUC) (Item C)
        (function(){
          try {
            const cookie = document.cookie.match(/(?:^|; )site_theme=([^;]+)/);
            let pref = cookie ? decodeURIComponent(cookie[1]) : 'auto';
            if(!['light','dark','auto'].includes(pref)) pref = 'auto';
            const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const mode = pref === 'auto' ? (systemDark ? 'dark':'light') : pref;
            document.documentElement.setAttribute('data-bs-theme', mode);
          } catch(e){}
        })();
      </script>
  <body style="scroll-padding-top: 70px;" data-bs-spy="scroll" data-bs-target="#navbarNavDarkDropdown" data-bs-offset="70">

    {% include layout/top-nav-bar.html %}

    {% include homepage/hero-random.html %}

    <div class="container py-4 py-xl-5">
      <section>
        <div class="container h-100 position-relative" style="top: -75px;">
          <div class="row gy-5 gy-lg-0 row-cols-1 row-cols-md-2 row-cols-lg-3">
            {% include sections/blog-section.html %}
            {% include sections/folklore-section.html %}
            {% include homepage/carousel.html %}
          </div>
        </div>
      </section>
    </div>

    {% include sections/career-section.html %}
    {% include sections/career-projects-section.html %}

    <!-- Footer -->
    {% include layout/footer.html %}

    <!-- Bootstrap core JavaScript -->
    {% include assets/js-bottom-of-body.html %}

    <script>
      // Random hero selection + image->video transition
      document.addEventListener('DOMContentLoaded', function() {
        const heroImg = document.getElementById('hero-img');
        const heroVideo = document.getElementById('hero-video');
        if (!heroImg || !heroVideo) return;

        // --- Random Hero Variant Selection ---
        // List of base filenames WITHOUT extension (must have matching .webp/.mp4 in folder)
        // To add a new hero: drop hero-<name>.webp & hero-<name>.mp4 into the folder and add 'hero-<name>' here.
        const HERO_FOLDER = '/img/categories/home-hero-images';
        const HERO_VARIANTS = [
          'hero-data-center',
          'hero-dice',
          'hero-digital-twin-power-grid',
          'hero-family',
          'hero-forest',
          'hero-hardware',
          'hero-lake',
          'hero-landscape',
          'hero-library',
          'hero-powerlines',
          'hero-village'
        ];

        // Pick one at random each page load
        const chosen = HERO_VARIANTS[Math.floor(Math.random() * HERO_VARIANTS.length)];
        const imgSrcWebp = `${HERO_FOLDER}/${chosen}.webp`;
        const videoSrcMp4 = `${HERO_FOLDER}/${chosen}.mp4`;

        // Derive a simple alt text from file name if not manually curated
        const altText = (function(file){
          try {
            let core = file.replace(/^hero-/, '').replace(/-/g, ' ');
            core = core.charAt(0).toUpperCase() + core.slice(1);
            return core + ' (hero image)';
          } catch(_) { return 'Homepage hero image'; }
        })(chosen);

        // Swap image source ASAP (keeps original as placeholder until this runs)
        heroImg.src = imgSrcWebp;
        heroImg.alt = altText;

        // Ensure the <source> inside the video uses the random variant
        let sourceEl = heroVideo.querySelector('source');
        if (!sourceEl) {
          sourceEl = document.createElement('source');
          heroVideo.appendChild(sourceEl);
        }
        sourceEl.setAttribute('src', videoSrcMp4);
        sourceEl.setAttribute('type', 'video/mp4');

        // Respect prefers-reduced-motion: skip autoplay video if user prefers less motion
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

        // --- Existing transition logic (slightly adapted) ---
        if (prefersReducedMotion) {
          // Don't auto-play video, keep static image
          heroVideo.parentElement && (heroVideo.parentElement.style.position = 'relative');
          heroVideo.style.display = 'none';
          return; // Exit early
        }

        window.addEventListener('load', function() {
          setTimeout(function() {
            heroVideo.style.display = 'block';
            heroVideo.style.opacity = '0';
            heroVideo.style.position = 'absolute';
            heroVideo.style.top = '0';
            heroVideo.style.left = '0';
            heroVideo.style.width = '100%';
            heroVideo.style.height = '100%';
            heroVideo.style.objectFit = 'cover';

            // (Re)load the newly assigned video source
            heroVideo.load();

            heroVideo.addEventListener('canplay', function() {
              heroVideo.play().then(function() {
                heroImg.style.transition = 'opacity 0.8s ease-in-out';
                heroVideo.style.transition = 'opacity 0.8s ease-in-out';
                setTimeout(function() {
                  heroImg.style.opacity = '0';
                  heroVideo.style.opacity = '1';
                }, 100);
              }).catch(function(error) {
                console.log('Video autoplay prevented:', error);
                heroVideo.style.display = 'none';
              });
            }, { once: true });

            // Fallback timeout
            setTimeout(function() {
              if (heroVideo.style.opacity === '0' || heroVideo.style.opacity === '') {
                console.log('Video load timeout, keeping image only');
                heroVideo.style.display = 'none';
              }
            }, 5000);
          }, 1500); // existing 1.5s delay
        });
      });

      // Random carousel start position with resilient Bootstrap init
      document.addEventListener('DOMContentLoaded', function() {
        const carousel = document.getElementById('carousel-of-all-blog-categories');
        if (!carousel) return;

        const carouselItems = carousel.querySelectorAll('.carousel-item');
        if (carouselItems.length === 0) return;

        // Generate random index
        const randomIndex = Math.floor(Math.random() * carouselItems.length);

        // Ensure only one active slide: remove any existing actives, then set random as active
        carouselItems.forEach((item, idx) => {
          if (idx === randomIndex) {
            item.classList.add('active');
            item.setAttribute('aria-current', 'true');
          } else {
            item.classList.remove('active');
            item.removeAttribute('aria-current');
          }
        });

        // Initialize Bootstrap carousel with retry until the script is available
        const tryInit = () => {
          try {
            const bs = window.bootstrap;
            if (!bs || typeof bs.Carousel !== 'function') return false;
            const instance = new bs.Carousel(carousel, { interval: 2000, ride: false });
            instance.to(randomIndex);
            return true;
          } catch (_) {
            return false;
          }
        };

        if (!tryInit()) {
          // Retry for a short period in case the CDN script finishes slightly later
          let attempts = 0;
          const maxAttempts = 50; // ~5 seconds at 100ms
          const timer = setInterval(() => {
            attempts++;
            if (tryInit() || attempts >= maxAttempts) {
              clearInterval(timer);
            }
          }, 100);
          // One more attempt on window load
          window.addEventListener('load', () => { tryInit(); }, { once: true });
        }
      });
    </script>

  </body>

  {% include utility/theme-debug.html %}

</html>