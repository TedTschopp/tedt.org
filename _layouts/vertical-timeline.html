<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="utf-8">

    {% include utility/calculate-variables.html %}

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <!-- IndieAuth and WebMentions Metadata -->
    {% include seo/indieauth-webmentions-metadata.html %}

    <!-- SEO Metadata -->
    {% include seo/meta-data-seo.html %}

    <!-- PWA Header Includes -->
    {% include pwa/pwa-header-includes.html %}

    <!-- News Feed Meta Tags -->
    {% include feeds/feeds.html %}

    <!-- START OF CSS INCLUDE -->
    {% include assets/all-css-includes.html %}
    <!-- END OF CSS INCLUDE -->

    <link rel="stylesheet" type="text/css" href="{{ '/css/main-landing-page.css' | relative_url }}">

    <style>
      h1, .h1 { 
        font-family: "Sofia Sans Extra Condensed", "Optima", "ManukaCondensed", "Manuka", "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-weight: 600;
        letter-spacing: -3px;
        font-size: 60px;
        font-stretch: extra-condensed;
      }
      .page-header {
        text-align: center;
        padding: 3rem 1rem;
        background: linear-gradient(135deg, #f8f6f0 0%, #e8e6e0 100%);
        margin-bottom: 2rem;
      }
      [data-bs-theme="dark"] .page-header {
        background: linear-gradient(135deg, rgba(7, 9, 15, 0.7) 0%, rgba(7, 9, 15, 0.5) 100%);
      }
      a { 
        text-decoration: underline;
        text-decoration-thickness: 1px;
      }
      a:hover, a:focus { 
        text-decoration: underline;
        text-decoration-thickness: 3px;
      }
    </style>

    <!-- Scripts that need to be at the end of the header -->
    {% include assets/scripts.html %}

    {% include utility/theme-debug-style.html %}
  </head>
  <body style="scroll-padding-top: 70px;" data-bs-spy="scroll" data-bs-target="#navbarNavDarkDropdown" data-bs-offset="70">

    {% include layout/top-nav-bar.html %}

    <main class="homepage--timeline">
      <!-- Page Header -->
      <div class="page-header">
        <h1>Content Timeline</h1>
        <p class="lead">Chronological journey through recent posts and category highlights</p>
      </div>

      <!-- Timeline Wrapper -->
      <div class="timeline-wrapper">
        {%- assign registry = site.data.category_registry -%}
        {%- assign timeline_items = '' | split: '' -%}

        <!-- Collect blog posts and categories -->
        {%- assign _blog_candidates = site.config.recent_by_category.blog | default: site.posts | safe_sort: 'date' | reverse -%}
        {%- assign item_index = 0 -%}

        {%- for post in _blog_candidates limit: 20 -%}
          {%- if post.categories contains "Bestiary" or post.categories contains "Draft" or post.categories contains "Role Playing Games" or post.categories contains "Folklore" or post.categories contains "Quotes" or post.categories contains "Home" or post.layout contains "micropubpost" or post.layout contains "gammaworld" or post.categories contains "Prompts" or post.layout contains "prompt" or post.path contains "_posts/Prompts/" -%}{%- continue -%}{%- endif -%}

          {%- assign composite = 'post||' | append: post.url | append: '||' | append: post.date | append: '||' | append: post.title -%}
          {%- assign timeline_items = timeline_items | push: composite -%}
          {%- assign item_index = item_index | plus: 1 -%}

          <!-- Intersperse category highlights every 3 posts -->
          {%- if item_index == 3 or item_index == 6 or item_index == 9 -%}
            {%- assign registry = site.data.category_registry -%}
            {%- assign cat_items = '' | split: '' -%}
            {%- for pair in registry limit: 1 -%}
              {%- assign slug = pair[0] | to_s | strip -%}
              {%- assign entry = pair[1] -%}
              {%- if slug == '' or entry.hide_from_carousel == true or entry.hide_from_carousel == 'true' -%}{%- continue -%}{%- endif -%}
              {%- assign has_posts = false -%}
              {%- assign _cached_recent = site.config.recent_by_category[slug] | default: site.config.recent_by_category[entry.title] -%}
              {%- for p in _cached_recent -%}
                {%- if p.path contains '_posts/Prompts/' -%}{%- continue -%}{%- endif -%}
                {%- assign matched = false -%}
                {%- if p.categories contains entry.title or p.categories contains slug -%}{%- assign matched = true -%}
                {%- endif -%}
                {%- if matched -%}{%- assign has_posts = true -%}{%- break -%}{%- endif -%}
              {%- endfor -%}
              {%- if has_posts -%}
                {%- assign composite_cat = 'category||' | append: slug | append: '||' | append: entry.title | append: '||' | append: entry.title -%}
                {%- assign timeline_items = timeline_items | push: composite_cat -%}
              {%- endif -%}
            {%- endfor -%}
          {%- endif -%}
        {%- endfor -%}

        <!-- Render timeline items -->
        {%- for composite in timeline_items -%}
          {%- assign parts = composite | split: '||' -%}
          {%- assign type = parts[0] -%}

          {%- if type == 'post' -%}
            {%- assign post_url = parts[1] -%}
            {%- assign post_date = parts[2] -%}
            {%- assign post_title = parts[3] -%}
            {%- assign post_obj = nil -%}

            {%- for p in site.posts -%}
              {%- if p.url == post_url -%}
                {%- assign post_obj = p -%}
                {%- break -%}
              {%- endif -%}
            {%- endfor -%}

            {%- if post_obj -%}
              <div class="timeline-item">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                  <div class="timeline-date">{{ post_obj.date | date: "%B %d, %Y" }}</div>
                  <h3 class="timeline-title"><a href="{{ post_obj.url | absolute_url }}">{{ post_obj.title }}</a></h3>
                  <p class="timeline-excerpt">
                    {%- assign __summary = post_obj.teaser | default: post_obj.description | default: post_obj.excerpt -%}
                    {%- if __summary == nil or __summary == '' -%}
                      {%- assign __summary = post_obj.content | strip_html | truncate: 180 -%}
                    {%- endif -%}
                    {{ __summary | strip_html }}
                  </p>
                </div>
              </div>
            {%- endif -%}

          {%- elsif type == 'category' -%}
            {%- assign slug = parts[1] -%}
            {%- assign entry = registry[slug] -%}

            {%- if entry.category_home_page -%}
              {%- assign category_href = entry.category_home_page -%}
            {%- else -%}
              {%- assign category_href = '/category/' | append: slug | append: '/' -%}
            {%- endif -%}

            {%- assign palette = entry.palette -%}
            {%- if palette -%}
              {%- assign start_color = palette.start | default: palette.gradient_start | default: '#f8f6f0' -%}
              {%- assign end_color = palette.end | default: palette.gradient_end | default: '#e8e6e0' -%}
              {%- assign accent_color = palette.accent | default: palette.titleColor | default: '#00446f' -%}
            {%- else -%}
              {%- assign start_color = '#f8f6f0' -%}
              {%- assign end_color = '#e8e6e0' -%}
              {%- assign accent_color = '#00446f' -%}
            {%- endif -%}

            <div class="timeline-item">
              <div class="timeline-dot"></div>
              <div class="timeline-content timeline-category" style="--theme-gradient-start: {{ start_color }}; --theme-gradient-end: {{ end_color }}; --theme-accent: {{ accent_color }};">
                <div class="category-emoji">{{ entry.emoji | default: 'üìå' }}</div>
                <h3 class="timeline-title"><a href="{{ category_href }}" style="text-decoration: none; color: inherit;">üè∑Ô∏è {{ entry.label | default: entry.title | default: slug }}</a></h3>
                <p style="margin: 0.75rem 0 1rem 0; opacity: 0.9;">{{ entry.description | default: entry.subtitle }}</p>

                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(0,0,0,0.1);">
                  {%- assign _recent_cat_posts = site.config.recent_by_category[slug] | default: site.config.recent_by_category[entry.title] -%}
                  {%- if _recent_cat_posts == nil -%}
                    {%- assign _recent_cat_posts = site.posts | safe_sort: 'date' | reverse | slice: 0, 30 -%}
                  {%- endif -%}
                  {%- assign post_count = 0 -%}
                  {%- for post in _recent_cat_posts -%}
                    {%- if post.path contains '_posts/Prompts/' or post.layout contains 'prompt' or post.categories contains 'Prompts' -%}{%- continue -%}{%- endif -%}
                    {%- if post_count >= 3 -%}{%- break -%}{%- endif -%}
                    {%- assign matched = false -%}
                    {%- if post.categories contains entry.title or post.categories contains slug -%}{%- assign matched = true -%}{%- endif -%}
                    {%- if matched == false and entry.raw_names -%}
                      {%- for rn in entry.raw_names -%}
                        {%- if post.categories contains rn -%}{%- assign matched = true -%}{%- break -%}{%- endif -%}
                      {%- endfor -%}
                    {%- endif -%}
                    {%- if matched -%}
                      {%- assign post_count = post_count | plus: 1 -%}
                      <div style="font-size: 0.9rem; margin: 0.5rem 0; line-height: 1.4;">‚ñ∏ <a href="{{ post.url | absolute_url }}">{{ post.title }}</a></div>
                    {%- endif -%}
                  {%- endfor -%}
                </div>
              </div>
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>

      <!-- All Posts Link -->
      <div style="text-align: center; margin-top: 4rem; padding: 2rem;">
        <a href="/blog/" class="btn btn-primary" style="padding: 0.875rem 2rem;">View All Posts</a>
      </div>
    </main>

    {% include layout/footer.html %}
    {% include assets/js-bottom-of-body.html %}
    <script src="{{ '/js/homepage-animations.js' | relative_url }}"></script>
  </body>
</html>
