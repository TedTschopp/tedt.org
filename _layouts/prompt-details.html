<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Details</title>

    {% include utility/calculate-variables.html %}
    
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    
    <!-- IndieAuth and WebMentions Metadata -->
    {% include seo/indieauth-webmentions-metadata.html %}
    
    <!-- SEO Metadata -->
    {% include seo/meta-data-seo.html %}
    
    <!-- PWA Header Includes -->
    {% include pwa/pwa-header-includes.html %}
    
    <!-- News Feed Meta Tags -->
    {% include feeds/feeds.html %}
    
    <!-- START OF CSS INCLUDE -->
    {% include assets/all-css-includes.html %}
    <!-- END OF CSS INCLUDE -->
    
    <!-- Custom AI Provider Button Styles -->
    <style>
        .btn-send-chatgpt {
            background-color: #10a37f;
            border-color: #10a37f;
            color: white;
        }
        .btn-send-chatgpt:hover, .btn-send-chatgpt:focus {
            background-color: #0d8f6c;
            border-color: #0d8f6c;
            color: white;
        }
        
        .btn-send-claude {
            background-color: #575754;
            border-color: #575754;
            color: white;
        }
        .btn-send-claude:hover, .btn-send-claude:focus {
            background-color: #6E6E6B ;
            border-color: #6E6E6B;
            color: white;
        }
        
        .btn-send-gemini {
            background-color: #1f1f1f;
            border-color: #1f1f1f;
            color: white;
        }
        .btn-send-gemini:hover, .btn-send-gemini:focus {
            background-color: #0d0d0d;
            border-color: #0d0d0d;
            color: white;
        }
        
        .btn-send-microsoft {
            background-color: #00a1f1;
            border-color: #00a1f1;
            color: white;
        }
        .btn-send-microsoft:hover, .btn-send-microsoft:focus {
            background-color: #008ed0;
            border-color: #008ed0;
            color: white;
        }
        
        .btn-send-github {
            background-color: #08872B;
            border-color: #08872B;
            color: white;
        }
        .btn-send-github:hover, .btn-send-github:focus {
            background-color: #5FED83;
            border-color: #5FED83;
            color: white;
        }
        
        .ai-provider-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .ai-provider-buttons .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.375rem 0.75rem;
            min-width: 2.5rem;
            height: 2.25rem;
        }
        
        .ai-provider-buttons .btn img {
            height: 1rem;
            width: auto;
            object-fit: contain;
            display: block;
            margin: auto;
        }
    </style>
    
    <!-- Prompt Variables Styles -->
    {% include prompt-variables-styles.html %}
    
    <!-- Scripts that need to be at the end of the header -->
    {% include assets/scripts.html %}


</head>

<body style="scroll-padding-top: 70px;" data-bs-spy="scroll" data-bs-target="#navbarNavDarkDropdown"
    data-bs-offset="70">

    <!-- Navbar -->
    {% include layout/top-nav-bar.html %}

    <main class="container my-4">
        <!-- Prompt Details Section -->
        <div class="card mb-4 prompt-details-card">

            <div class="card-header d-flex justify-content-between align-items-center">
                    <div class="card h-100 no-padding">
                        {% if page.image %}
                        {% if page.image-alt %}
                        {% assign image_alt = page.image-alt %}
                        {% elsif page.image-description %}
                        {% assign image_alt = page.image-description %}
                        {% else %}
                        {% assign image_alt = page.title %}
                        {% endif %}
                    
                        {% if page.image-credits-title %}
                        {% assign image_credits_title = page.image-credits-title %}
                        {% elsif page.image-title %}
                        {% assign image_credits_title = page.image-title %}
                        {% else %}
                        {% assign image_credits_title = "Unknown" %}
                        {% endif %}
                    
                        {% if page.image-credits-artist %}
                        {% assign image_credits = page.image-credits-artist %}
                        {% elsif page.image-artist %}
                        {% assign image_credits = page.image-artist %}
                        {% else %}
                        {% assign image_credits = "Unknown" %}
                        {% endif %}
                    
                        {% if page.image-credits-artist-URL %}
                        {% assign image_credits_artist_URL = page.image-credits-artist-URL %}
                        {% elsif page.image-artist-URL %}
                        {% assign image_credits_artist_URL = page.image-artist-URL %}
                        {% endif %}
                    
                        {% if page.image contains "http" %}
                        {% assign image_URL = page.image %}
                        {% else %}
                        {% assign image_URL = site.siteurl | append: "/" | append: page.image %}
                        {% endif %}
                        {% else %}
                        {% if site.featured-image %}
                        {% if site.featured-image contains "http" %}
                        {% assign image_URL = site.featured-image %}
                        {% else %}
                        {% assign image_URL = site.siteurl | append: "/" | append: site.featured-image %}
                        {% endif %}
                        {% else %}
                        {% assign image_URL = site.siteurl | append: "/img/No-Image-Provided.png" %}
                        {% endif %}
                    
                        {% assign image_alt = "A man walks through a forest along a path. The mood is tranquil, reflective, spiritually
                        uplifting with a hint of poetic longing::2, painting, oil on canvas, impasto. The brushwork has rich textures,
                        earthy palette with luminous highlights" %}
                        {% assign image_credits_title = 'In Search of an Image - "No Image Associated with this article"' %}
                        {% assign image_credits = "Ted Tschopp" %}
                        {% assign image_credits_artist_URL = "https://tedt.org/" %}
                        {% endif %}
                        <div class="card h-100 position-relative">
                            <img class="card-img-top w-100 d-block" src="{{ image_URL }}" alt="{{image_alt}} by {{image_credits}}">
                            <div class="card-img-overlay d-flex flex-column align-items-start justify-content-end p-0 ps-2">
                                <div class="position-absolute top-0 start-0 w-100 h-100"
                                    style="background: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.8)); z-index: 1;"></div>
                    
                                <h1 class="card-title p-name stroke-glow-text" style="z-index: 2; position: relative;">{{ page.title }}</h1>
                                {% if page.subtitle %}<p class="stroke-glow-text card-subtitle h2 text-muted mb-2"
                                    style="z-index: 2; position: relative;">{{page.subtitle}}</p>{% endif %}
                    
                                <div class="d-flex align-items-center" style="z-index: 2; position: relative;">
                                    <!-- Author TODO: Fix this to be dynamic for more than one author. -->
                                    {% if page.author.name %}
                                    <p class="card-text">written by <a rel="author" class="p-author h-card"
                                            href="{{ page.author.url }}"><img src="{{page.author.avatar}}" style="height: 1.2em;"
                                                class="img-fluid align-self-center u-photo">{{page.author.name}}</a></p>
                                    {% else %}
                                    <p class="card-text">written by <a rel="author" class="p-author h-card"
                                            href="{{ site.author.url }}"><img src="{{site.author.avatar}}" style="height: 1.2em;"
                                                class="img-fluid align-self-center u-photo">{{site.author.name}}</a></p>
                                    {% endif %}
                                </div>
                    
                                <div class="d-flex align-items-center" style="z-index: 2; position: relative;">
                                    {% if image-credits-URL contains "http" %}
                                    <cite><a target="_new" href="{{image_credits_URL }}">{{image_credits_title}}</a></cite>
                                    {% else %}
                                    <cite>{{image_credits_title}}</cite>
                                    {% endif %}
                                    {% if image-credits-artist-URL contains "http" %}
                                    <span class="vcard">
                                        <address style="display: inline;" class="author">:&nbsp;an image by <a rel="author" target="_new"
                                                class="url fn n" href="{{image_credits_artist_URL}}">{{image_credits}}</a></address>
                                    </span>
                                    {% else %}
                                    :&nbsp;an image by {{image_credits}}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
            <div class="card-body">
                <p class="card-text mb-3">{{page.content | trim}}</p>
                
                <div class="w-100 mb-3">
                    {% for tag in page.tags %}
                        <span class="badge bg-primary me-1 mb-1"><i class="fas fa-tag"></i> {{ tag }}</span>
                    {% endfor %}
                </div>

                <div class="card my-3">
                    <div class="card-header justify-content-between d-flex align-items-center highlight-toolbar ps-3 pe-2 py-1 border-0 border-top border-bottom">

                        <div class="d-flex align-items-center gap-3">
                            <span>Prompt</span>
                            {% if page.variables and page.variables.size > 0 %}
                            <button class="btn btn-secondary btn-sm" 
                                    type="button" 
                                    id="toggle-variables-btn"
                                    aria-expanded="false"
                                    aria-controls="prompt-variables-card"
                                    aria-label="Show customization options for prompt variables">
                                <i class="fas fa-sliders-h" aria-hidden="true"></i> Customize
                            </button>
                            {% endif %}
                        </div>

                        <div class="d-flex align-items-center gap-3 prompt-control-buttons" role="group" aria-label="Download or Copy Prompt">
                            <!--
                            <button class="btn btn-outline-danger btn-sm btn-like" aria-label="Like this prompt">
                                <i class="fas fa-heart"></i> <span class="like-count">0</span>
                            </button>
                            -->

                            <a href="#" id="download-prompt-link"
                                class="btn btn-primary btn-sm" download="{{ page.title | slugify }}.txt">
                                <i class="fas fa-download"></i> Download Prompt
                            </a>

                            <button class="btn btn-primary btn-copy-prompt btn-sm" 
                                type="button" 
                                data-bs-original-title="Copy prompt to clipboard"
                                data-bs-toggle="tooltip" 
                                data-bs-placement="top"
                                aria-label="Copy current prompt to clipboard"
                                title="Copy prompt to clipboard">
                                <i class="fas fa-copy" aria-hidden="true"></i> Copy Prompt
                            </button>
                        </div>

                        <div class="ai-provider-buttons" role="group" aria-label="Send prompt to AI providers">
                            <!-- OpenAI ChatGPT -->
                            {% assign openai_models = page.models-supported | where_exp: "model", "model contains 'gpt' or model contains '03' or model contains '04' or model contains 'o1'" %}
                            {% if openai_models.size > 0 %}
                            <button class="btn btn-send-chatgpt btn-sm mt-0 me-2 d-flex align-items-center" 
                                    type="button" 
                                    id="chatgptSendDefault" 
                                    aria-label="Send prompt to ChatGPT"
                                    title="Send prompt to OpenAI ChatGPT">
                                <img src="/img/logos/OpenAI-Logo.svg" alt="OpenAI Logo" width="20" height="20">
                            </button>
                            {% endif %}

                            <!-- Anthropic Claude -->
                            {% assign anthropic_models = page.models-supported | where_exp: "model", "model contains 'claude'" %}
                            {% if anthropic_models.size > 0 %}
                            <button class="btn btn-send-claude btn-sm mt-0 me-2 d-flex align-items-center" 
                                    type="button" 
                                    id="claudeSendDefault" 
                                    aria-label="Send prompt to Claude"
                                    title="Send prompt to Anthropic Claude">
                                <img src="/img/logos/Claude-AI-Logo.svg" alt="Claude AI Logo" width="20" height="20">
                            </button>
                            {% endif %}

                            <!-- Google AI -->
                            {% assign google_models = page.models-supported | where_exp: "model", "model contains 'gemini'" %}
                            {% if google_models.size > 0 %}
                            <button class="btn btn-send-gemini btn-sm mt-0 me-2 d-flex align-items-center" 
                                    type="button" 
                                    id="geminiSendDefault" 
                                    aria-label="Send prompt to Gemini"
                                    title="Send prompt to Google Gemini">
                                <img src="/img/logos/Google-Gemini-Logo.svg" alt="Google Gemini Logo" width="20" height="20">
                            </button>
                            {% endif %}

                            <!-- Microsoft Copilot -->
                            {% assign microsoft_models = page.models-supported | where_exp: "model", "model contains 'copilot' or model contains 'microsoft'" %}
                            {% if microsoft_models.size > 0 %}
                            <button class="btn btn-send-microsoft btn-sm mt-0 me-2 d-flex align-items-center" 
                                    type="button" 
                                    id="microsoftSendDefault" 
                                    aria-label="Send prompt to Microsoft Copilot"
                                    title="Send prompt to Microsoft Copilot">
                                <img src="/img/logos/Microsoft-Copilot-Logo.svg" alt="Microsoft Copilot Logo" width="20" height="20">
                            </button>
                            {% endif %}

                            <!-- GitHub Copilot -->
                            {% assign github_models = page.models-supported | where_exp: "model", "model contains 'github'" %}
                            {% if github_models.size > 0 %}
                            <button class="btn btn-send-github btn-sm mt-0 me-0 d-flex align-items-center" 
                                    type="button" 
                                    id="githubSendDefault" 
                                    aria-label="Send prompt to GitHub Copilot"
                                    title="Send prompt to GitHub Copilot">
                                <img src="/img/logos/GitHub-Copilot-Logo.svg" alt="GitHub Copilot Logo" width="20" height="20">
                            </button>
                            {% endif %}
                            </div> <!-- Close ai-provider-buttons -->
                        </div>
                    </div>
                    
                    <!-- Prompt Variables Form -->
                    {% include prompt-variables-form.html %}
                    
                    <div class="card-body p-1 prompt-content-section" markdown="0">
                        <!-- Original prompt (hidden when variables are customized) -->
                        <pre id="original-prompt" 
                             class="bg-dark text-white rounded" 
                             style="margin-bottom: 0px; white-space: pre-wrap; word-break: break-word;"
                             role="region"
                             aria-label="Original prompt content"
                             tabindex="0"><code class="language-markdown">{% if page.prompt_content %}{{ page.prompt_content }}{% else %}{{ page.content }}{% endif %}</code></pre>
                        
                        <!-- Customized prompt (shown when variables are filled) -->
                        <pre id="customized-prompt" 
                             class="bg-dark text-white rounded" 
                             style="margin-bottom: 0px; white-space: pre-wrap; word-break: break-word; display: none;"
                             role="region"
                             aria-label="Customized prompt content with your variables"
                             tabindex="0"><code class="language-markdown" id="customized-prompt-content">{% if page.prompt_content %}{{ page.prompt_content }}{% else %}{{ page.content }}{% endif %}</code></pre>
                        
                        <!-- Status region for screen readers -->
                        <div class="visually-hidden" id="form-status" role="status" aria-live="polite"></div>
                    </div>
                </div>

                <div class="text-end mt-3">
                    <a href="#" id="download-prompt-link-bottom" class="btn btn-primary ms-3"
                        download="{{ page.title | slugify }}.txt">
                        <i class="fas fa-download"></i>
                    </a>
                </div>
                <!-- Adjusted layout to align 'Prompts in this Series' header on the left and 'Rate this Prompt Series' with 'Download All Prompts in Series' on the right -->
                <div class="mt-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <h3 class="card-title">Prompts in this Series</h3>
                    </div>

                    <div class="d-flex">
                        <ol class="list-group list-group-numbered flex-grow-1 me-4">
                            <li class="list-group-item d-flex justify-content-between align-items-start">
                                <div class="ms-2 me-auto">
                                    <div class="fw-bold">Step 1: Introduction</div>
                                    A brief description of the first step in the series.
                                </div>
                                <span class="badge bg-primary rounded-pill">Step 1</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-start">
                                <div class="ms-2 me-auto">
                                    <div class="fw-bold">Step 2: Deep Dive</div>
                                    A brief description of the second step in the series.
                                </div>
                                <span class="badge bg-secondary rounded-pill">Step 2</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-start">
                                <div class="ms-2 me-auto">
                                    <div class="fw-bold">Step 3: Conclusion</div>
                                    A brief description of the final step in the series.
                                </div>
                                <span class="badge bg-success rounded-pill">Step 3</span>
                            </li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <!-- Related Prompts Section -->
        <div>
            <h3>Related Prompts</h3>
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                
                <!-- Debug flag - set to true to enable debugging, false to disable -->
                {% assign debug_related_prompts = false %}
                
                {% assign current_tags = page.tags | default: empty %}
                {% assign found_prompts = 0 %}
                {% assign total_checked = 0 %}
                
                <!-- Debug Info (only show if debugging is enabled) -->
                {% if debug_related_prompts %}
                <div class="col-12 mb-3">
                    <div class="alert alert-info">
                        <h6>Debug Info:</h6>
                        <p><strong>Current page:</strong> {{ page.title }}</p>
                        <p><strong>Current tags:</strong> 
                            {% if current_tags.size > 0 %}
                                {% for tag in current_tags %}{{ tag }}{% unless forloop.last %}, {% endunless %}{% endfor %}
                            {% else %}
                                No tags
                            {% endif %}
                        </p>
                        <p><strong>Current layout:</strong> {{ page.layout }}</p>
                    </div>
                </div>
                {% endif %}
                
                <!-- Check site.posts for prompts -->
                {% for post in site.posts %}
                    {% assign total_checked = total_checked | plus: 1 %}
                    {% if post.layout == 'prompt-details' and post.url != page.url %}
                        {% assign post_tags = post.tags | default: empty %}
                        {% assign overlap_count = 0 %}
                        
                        <!-- Calculate overlap -->
                        {% if current_tags.size > 0 and post_tags.size > 0 %}
                            {% for current_tag in current_tags %}
                                {% for post_tag in post_tags %}
                                    {% if current_tag == post_tag %}
                                        {% assign overlap_count = overlap_count | plus: 1 %}
                                        {% break %}
                                    {% endif %}
                                {% endfor %}
                            {% endfor %}
                        {% endif %}
                        
                        <!-- Show if we have overlap -->
                        {% if overlap_count > 0 %}
                            {% assign found_prompts = found_prompts | plus: 1 %}
                            <div class="col">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <a href="{{ post.url | relative_url }}">
                                            <h5 class="card-title">{{ post.title }}</h5>
                                        </a>
                                        <p class="card-text">{{ post.description | default: post.excerpt | strip_html | truncate: 120 }}</p>
                                        <div class="mt-2">
                                            {% for tag in post_tags %}
                                            <span class="badge bg-primary"><i class="fas fa-tag"></i> {{ tag }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                        
                        <!-- Show all prompts for debugging (only if debugging enabled and limit to first 3) -->
                        {% if debug_related_prompts and found_prompts < 3 and overlap_count == 0 %}
                            <div class="col-12">
                                <div class="alert alert-warning">
                                    <small>
                                        <strong>Checked:</strong> {{ post.title }}<br>
                                        <strong>Tags:</strong> 
                                        {% if post_tags.size > 0 %}
                                            {% for tag in post_tags %}{{ tag }}{% unless forloop.last %}, {% endunless %}{% endfor %}
                                        {% else %}
                                            No tags
                                        {% endif %}<br>
                                        <strong>Overlap:</strong> {{ overlap_count }}
                                    </small>
                                </div>
                            </div>
                        {% endif %}
                    {% endif %}
                {% endfor %}
                
                <!-- Debug Summary (only show if debugging is enabled) -->
                {% if debug_related_prompts %}
                <div class="col-12 mt-3">
                    <div class="alert alert-success">
                        <h6>Summary:</h6>
                        <p><strong>Total posts checked:</strong> {{ total_checked }}</p>
                        <p><strong>Related prompts found:</strong> {{ found_prompts }}</p>
                    </div>
                </div>
                {% endif %}
                
                <!-- Fallback message if no results -->
                {% if found_prompts == 0 %}
                    <div class="col-12">
                        <div class="alert alert-info" role="alert">
                            <h5 class="alert-heading">No Related Prompts Found</h5>
                            <p class="mb-0">We couldn't find any prompts with overlapping tags. <a href="https://tedt.org/category/Prompts/" class="alert-link">Browse all prompts</a> to discover more.</p>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </main>

    <!-- Footer -->
    {% include layout/footer.html %}

    <!-- Bootstrap core JavaScript -->
    {% include assets/js-bottom-of-body.html %}


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables for prompt management
        let originalPrompt = `{% if page.prompt_content %}{{ page.prompt_content }}{% else %}{{ page.content }}{% endif %}`;
        let customizedPrompt = originalPrompt;
        let variableDefinitions = [];
        
        {% if page.variables and page.variables.size > 0 %}
        variableDefinitions = [
            {% for variable in page.variables %}
            {
                name: "{{ variable.name }}",
                label: "{{ variable.label }}",
                type: "{{ variable.type }}",
                default: {% if variable.default %}"{{ variable.default }}"{% else %}""{% endif %},
                required: {{ variable.required | default: false }},
                options: {% if variable.options %}{{ variable.options | jsonify }}{% else %}[]{% endif %}
            }{% unless forloop.last %},{% endunless %}
            {% endfor %}
        ];
        {% endif %}

        // Like button functionality
        document.querySelectorAll('.btn-like').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                const countSpan = this.querySelector('.like-count');
                let count = parseInt(countSpan.textContent, 10);
                if (!this.classList.contains('liked')) {
                    count++;
                    this.classList.add('liked');
                    this.querySelector('i').classList.add('text-danger');
                } else {
                    count--;
                    this.classList.remove('liked');
                    this.querySelector('i').classList.remove('text-danger');
                }
                countSpan.textContent = count;
            });
        });

        // Copy button for Prompt Example
        document.querySelectorAll('.card-header .btn-copy-prompt').forEach(btn => {
            btn.addEventListener('click', function() {
                const pre = document.querySelector('#customized-prompt:not([style*="display: none"]) pre, #original-prompt pre');
                if (pre) {
                    navigator.clipboard.writeText(getCurrentPromptContent());
                    const original = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    setTimeout(() => {
                        this.innerHTML = original;
                    }, 1500);
                }
            });
        });

        // Helper function to get current prompt content (original or customized)
        function getCurrentPromptContent() {
            const customizedElement = document.getElementById('customized-prompt');
            if (customizedElement && customizedElement.style.display !== 'none') {
                return customizedPrompt;
            }
            return originalPrompt;
        }

        // Function to replace variables in prompt content
        function replaceVariables(content, variables) {
            let result = content;
            for (const [key, value] of Object.entries(variables)) {
                // Handle both {{variable}} and {{ variable }} formats
                const regex = new RegExp(`\\{\\{\\s*${key}\\s*\\}\\}`, 'g');
                // If value is empty, keep the placeholder, otherwise replace with the value
                const replacement = value && value.trim() !== '' ? value : `{{${key}}}`;
                result = result.replace(regex, replacement);
            }
            return result;
        }

        // Function to collect current variable values
        function collectVariableValues() {
            const values = {};
            variableDefinitions.forEach(variable => {
                if (variable.type === 'checkbox') {
                    const checkboxes = document.querySelectorAll(`input[data-variable="${variable.name}"]:checked`);
                    values[variable.name] = Array.from(checkboxes).map(cb => cb.value).join(', ');
                } else if (variable.type === 'radio') {
                    const radio = document.querySelector(`input[data-variable="${variable.name}"]:checked`);
                    values[variable.name] = radio ? radio.value : (variable.default || '');
                } else {
                    const element = document.querySelector(`[data-variable="${variable.name}"]`);
                    values[variable.name] = element ? element.value : (variable.default || '');
                }
            });
            return values;
        }

        // Function to update prompt preview
        function updatePromptPreview() {
            if (variableDefinitions.length === 0) return;
            
            const variables = collectVariableValues();
            customizedPrompt = replaceVariables(originalPrompt, variables);
            
            const customizedElement = document.getElementById('customized-prompt-content');
            const originalElement = document.getElementById('original-prompt');
            const customizedContainer = document.getElementById('customized-prompt');
            
            if (customizedElement && customizedContainer) {
                customizedElement.textContent = customizedPrompt;
                
                // Show customized version if any variables have been filled
                const hasValues = Object.values(variables).some(value => value && value.trim() !== '');
                if (hasValues) {
                    originalElement.style.display = 'none';
                    customizedContainer.style.display = 'block';
                } else {
                    originalElement.style.display = 'block';
                    customizedContainer.style.display = 'none';
                }
            }
        }

        // Enhanced form validation with accessibility
        function validateForm() {
            let isValid = true;
            const errors = [];
            
            variableDefinitions.forEach(variable => {
                if (variable.required) {
                    const value = collectVariableValues()[variable.name];
                    const element = document.querySelector(`[data-variable="${variable.name}"]`);
                    const errorElement = document.getElementById(`error-${variable.name}`);
                    const successElement = document.getElementById(`success-${variable.name}`);
                    
                    if (!value || value.trim() === '') {
                        element?.classList.add('is-invalid');
                        element?.classList.remove('is-valid');
                        
                        if (errorElement) {
                            errorElement.textContent = `${variable.label} is required`;
                            errorElement.style.display = 'block';
                        }
                        if (successElement) {
                            successElement.style.display = 'none';
                        }
                        
                        // Add to ARIA description
                        element?.setAttribute('aria-describedby', `error-${variable.name} help-${variable.name}`);
                        element?.setAttribute('aria-invalid', 'true');
                        
                        errors.push(`${variable.label} is required`);
                        isValid = false;
                    } else {
                        element?.classList.remove('is-invalid');
                        element?.classList.add('is-valid');
                        
                        if (errorElement) {
                            errorElement.style.display = 'none';
                        }
                        if (successElement) {
                            successElement.style.display = 'block';
                        }
                        
                        // Update ARIA description
                        element?.setAttribute('aria-describedby', `help-${variable.name}`);
                        element?.setAttribute('aria-invalid', 'false');
                    }
                }
            });
            
            // Announce validation results to screen readers
            const statusElement = document.getElementById('form-status');
            if (statusElement) {
                if (isValid) {
                    statusElement.textContent = 'All form fields are valid';
                } else {
                    statusElement.textContent = `Form has ${errors.length} errors: ${errors.join(', ')}`;
                }
            }
            
            return isValid;
        }

        // Function to reset form to defaults
        function resetForm() {
            variableDefinitions.forEach(variable => {
                if (variable.type === 'checkbox') {
                    const checkboxes = document.querySelectorAll(`input[data-variable="${variable.name}"]`);
                    checkboxes.forEach(cb => {
                        cb.checked = variable.default && variable.default.includes(cb.value);
                    });
                } else if (variable.type === 'radio') {
                    const radios = document.querySelectorAll(`input[data-variable="${variable.name}"]`);
                    radios.forEach(radio => {
                        radio.checked = radio.value === variable.default;
                    });
                } else {
                    const element = document.querySelector(`[data-variable="${variable.name}"]`);
                    if (element) {
                        element.value = variable.default || '';
                        element.classList.remove('is-invalid', 'is-valid');
                    }
                }
            });
            updatePromptPreview();
        }

        // Initialize functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Enhanced toggle variables form with accessibility
            const toggleBtn = document.getElementById('toggle-variables-btn');
            const variablesCard = document.getElementById('prompt-variables-card');
            
            if (toggleBtn && variablesCard) {
                toggleBtn.addEventListener('click', function() {
                    const isHidden = variablesCard.style.display === 'none';
                    
                    if (isHidden) {
                        variablesCard.style.display = 'block';
                        variablesCard.classList.add('show');
                        toggleBtn.classList.add('active');
                        toggleBtn.innerHTML = '<i class="fas fa-times" aria-hidden="true"></i> Hide Variables';
                        toggleBtn.setAttribute('aria-expanded', 'true');
                        toggleBtn.setAttribute('aria-label', 'Hide customization options for prompt variables');
                        
                        // Focus management for accessibility
                        setTimeout(() => {
                            const firstInput = variablesCard.querySelector('.prompt-variable');
                            if (firstInput) {
                                firstInput.focus();
                            }
                        }, 100);
                    } else {
                        variablesCard.style.display = 'none';
                        variablesCard.classList.remove('show');
                        toggleBtn.classList.remove('active');
                        toggleBtn.innerHTML = '<i class="fas fa-sliders-h" aria-hidden="true"></i> Customize';
                        toggleBtn.setAttribute('aria-expanded', 'false');
                        toggleBtn.setAttribute('aria-label', 'Show customization options for prompt variables');
                    }
                });
                
                // Escape key handler for better UX
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && variablesCard.style.display !== 'none') {
                        toggleBtn.click();
                        toggleBtn.focus();
                    }
                });
            }

            // Enhanced update prompt button with loading states
            const updateBtn = document.getElementById('update-prompt-btn');
            if (updateBtn) {
                updateBtn.addEventListener('click', function() {
                    if (validateForm()) {
                        // Show loading state
                        this.classList.add('btn-loading');
                        this.setAttribute('aria-label', 'Updating prompt preview...');
                        this.disabled = true;
                        
                        // Update the preview
                        updatePromptPreview();
                        
                        // Announce success to screen readers
                        const statusElement = document.getElementById('form-status');
                        if (statusElement) {
                            statusElement.textContent = 'Prompt preview updated successfully';
                        }
                        
                        // Remove loading state
                        setTimeout(() => {
                            this.classList.remove('btn-loading');
                            this.setAttribute('aria-label', 'Update prompt with current variable values');
                            this.disabled = false;
                            
                            // Clear status after delay
                            setTimeout(() => {
                                if (statusElement) {
                                    statusElement.textContent = '';
                                }
                            }, 3000);
                        }, 500);
                    } else {
                        // Focus on first invalid field for accessibility
                        const firstInvalid = document.querySelector('.is-invalid');
                        if (firstInvalid) {
                            firstInvalid.focus();
                        }
                    }
                });
            }

            // Reset button
            const resetBtn = document.getElementById('reset-variables-btn');
            if (resetBtn) {
                resetBtn.addEventListener('click', resetForm);
            }

            // Enhanced real-time updates with accessibility feedback
            document.querySelectorAll('.prompt-variable').forEach(input => {
                ['input', 'change', 'keyup'].forEach(eventType => {
                    input.addEventListener(eventType, function() {
                        // Clear validation classes on input
                        this.classList.remove('is-invalid', 'is-valid');
                        this.setAttribute('aria-invalid', 'false');
                        
                        // Clear any existing error messages
                        const errorElement = document.getElementById(`error-${this.dataset.variable}`);
                        if (errorElement) {
                            errorElement.style.display = 'none';
                        }
                        
                        // Update preview in real-time (debounced)
                        clearTimeout(this.updateTimeout);
                        this.updateTimeout = setTimeout(() => {
                            updatePromptPreview();
                            
                            // Announce update to screen readers (throttled)
                            if (!this.lastAnnouncement || Date.now() - this.lastAnnouncement > 2000) {
                                const statusElement = document.getElementById('form-status');
                                if (statusElement) {
                                    statusElement.textContent = 'Prompt preview updated';
                                    setTimeout(() => {
                                        if (statusElement.textContent === 'Prompt preview updated') {
                                            statusElement.textContent = '';
                                        }
                                    }, 1500);
                                }
                                this.lastAnnouncement = Date.now();
                            }
                        }, 300);
                    });
                });
                
                // Enhanced focus handling for better UX
                input.addEventListener('focus', function() {
                    this.classList.add('focused');
                });
                
                input.addEventListener('blur', function() {
                    this.classList.remove('focused');
                    
                    // Validate individual field on blur if it has content
                    if (this.value.trim() && this.hasAttribute('required')) {
                        this.classList.add('is-valid');
                        this.setAttribute('aria-invalid', 'false');
                        
                        const successElement = document.getElementById(`success-${this.dataset.variable}`);
                        if (successElement) {
                            successElement.style.display = 'block';
                        }
                    }
                });
            });

            // Initialize with default values
            if (variableDefinitions.length > 0) {
                updatePromptPreview();
            }

            // Setup download links
            function setupDownloadLinks() {
                const downloadLinks = document.querySelectorAll('#download-prompt-link, #download-prompt-link-bottom');
                downloadLinks.forEach(link => {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        const content = getCurrentPromptContent();
                        const blob = new Blob([content], { type: 'text/plain' });
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = "{{ page.title | slugify }}.txt";
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                    });
                });
            }
            // Setup copy button functionality with improved feedback
            const copyBtn = document.querySelector('.btn-copy-prompt');
            if (copyBtn) {
                copyBtn.addEventListener('click', function() {
                    const content = getCurrentPromptContent();
                    
                    // Update loading state and accessibility
                    this.classList.add('btn-loading');
                    this.setAttribute('aria-label', 'Copying prompt...');
                    
                    navigator.clipboard.writeText(content).then(() => {
                        // Success feedback
                        this.classList.remove('btn-loading');
                        this.classList.add('copied');
                        this.innerHTML = '<i class="fas fa-check" aria-hidden="true"></i> Copied!';
                        this.setAttribute('aria-label', 'Prompt copied successfully');
                        
                        // Announce to screen readers
                        const statusElement = document.getElementById('form-status');
                        if (statusElement) {
                            statusElement.textContent = 'Prompt copied to clipboard successfully';
                        }
                        
                        // Reset after 2 seconds
                        setTimeout(() => {
                            this.classList.remove('copied');
                            this.innerHTML = '<i class="fas fa-copy" aria-hidden="true"></i> Copy Prompt';
                            this.setAttribute('aria-label', 'Copy current prompt to clipboard');
                            if (statusElement) {
                                statusElement.textContent = '';
                            }
                        }, 2000);
                    }).catch(err => {
                        // Error feedback
                        this.classList.remove('btn-loading');
                        this.innerHTML = '<i class="fas fa-exclamation-triangle" aria-hidden="true"></i> Error';
                        this.setAttribute('aria-label', 'Failed to copy prompt');
                        
                        const statusElement = document.getElementById('form-status');
                        if (statusElement) {
                            statusElement.textContent = 'Failed to copy prompt to clipboard';
                        }
                        
                        // Reset after 2 seconds
                        setTimeout(() => {
                            this.innerHTML = '<i class="fas fa-copy" aria-hidden="true"></i> Copy Prompt';
                            this.setAttribute('aria-label', 'Copy current prompt to clipboard');
                            if (statusElement) {
                                statusElement.textContent = '';
                            }
                        }, 2000);
                    });
                });
            }

            // OpenAI ChatGPT button handler
            var chatgptBtn = document.getElementById('chatgptSendDefault');
            if (chatgptBtn) {
                chatgptBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    var defaultModel = "gpt-4";
                    var promptTitle = encodeURIComponent("{{ page.title }}");
                    var promptContent = encodeURIComponent(getCurrentPromptContent());
                    var url = `https://chat.openai.com/?model=${defaultModel}&q=${promptContent}`;
                    window.open(url, '_blank', 'noopener');
                });
            }

            // Anthropic Claude button handler
            var claudeBtn = document.getElementById('claudeSendDefault');
            if (claudeBtn) {
                claudeBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    var promptTitle = "{{ page.title | escape }}";
                    var promptContent = getCurrentPromptContent();
                    var fullPrompt = promptTitle + "\n\n" + promptContent;
                    
                    navigator.clipboard.writeText(fullPrompt).then(function() {
                        alert('Prompt copied to clipboard! Please paste it into Claude.ai');
                        window.open('https://claude.ai/', '_blank', 'noopener');
                    });
                });
            }

            // Google Gemini button handler
            var geminiBtn = document.getElementById('geminiSendDefault');
            if (geminiBtn) {
                geminiBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    var promptTitle = "{{ page.title | escape }}";
                    var promptContent = getCurrentPromptContent();
                    var fullPrompt = promptTitle + "\n\n" + promptContent;
                    
                    navigator.clipboard.writeText(fullPrompt).then(function() {
                        alert('Prompt copied to clipboard! Please paste it into Gemini');
                        window.open('https://gemini.google.com/', '_blank', 'noopener');
                    });
                });
            }

            // Microsoft Copilot button handler
            var microsoftBtn = document.getElementById('microsoftSendDefault');
            if (microsoftBtn) {
                microsoftBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    var promptTitle = "{{ page.title | escape }}";
                    var promptContent = getCurrentPromptContent();
                    var fullPrompt = promptTitle + "\n\n" + promptContent;
                    
                    navigator.clipboard.writeText(fullPrompt).then(function() {
                        alert('Prompt copied to clipboard! Please paste it into Microsoft Copilot');
                        window.open('https://copilot.microsoft.com/', '_blank', 'noopener');
                    });
                });
            }

            // GitHub Copilot button handler
            var githubBtn = document.getElementById('githubSendDefault');
            if (githubBtn) {
                githubBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    var promptTitle = encodeURIComponent("{{ page.title }}");
                    var promptContent = encodeURIComponent(getCurrentPromptContent());
                    var url = `https://github.com/copilot?prompt=${promptContent}`;
                    window.open(url, '_blank', 'noopener');
                });
            }
        });
    </script>
</body>

</html>