---
layout: none
---
<!DOCTYPE html>
<html lang="en" data-bs-theme="dark" class="layout-reveal">
<head>
    <meta charset="utf-8">

    {% include utility/calculate-variables.html %}
    
    <title>{{ page.title | escape }} â€“ {{ site.title }}</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <!-- IndieAuth and WebMentions Metadata -->
    {% include seo/indieauth-webmentions-metadata.html %}

    <!-- SEO Metadata -->
    {% include seo/meta-data-seo.html %}

    <!-- PWA Header Includes -->
    {% include pwa/pwa-header-includes.html %}

    <!-- News Feed Meta Tags -->
    {% include feeds/feeds.html %}

    <!-- Site CSS includes -->
    {% include assets/all-css-includes.html %}

    <!-- Reveal.js core CSS -->
    <link rel="stylesheet" href="https://unpkg.com/reveal.js@5/dist/reveal.css">
    <link rel="stylesheet" href="https://unpkg.com/reveal.js@5/dist/theme/black.css" id="theme-dark">
    <link rel="stylesheet" href="https://unpkg.com/reveal.js@5/dist/theme/white.css" id="theme-light" disabled>

</head>

<body style="scroll-padding-top: 70px;" data-bs-spy="scroll" data-bs-target="#navbarNavDarkDropdown" data-bs-offset="70">
    {% include layout/top-nav-bar.html %}
    
    <div class="reveal-container">
        <div class="reveal">
            <div class="slides">
            {% if page.markdown %}
            <section data-markdown data-separator="^\n---\n" data-separator-vertical="^\n--\n" data-charset="utf-8">
                <textarea data-template aria-label="Slide markdown template source" title="Slide markdown template source">{{ content | strip }}</textarea>
            </section>
            {% else %}
            {{ content }}
            {% endif %}
            </div>
        </div>
    </div>

    <!-- Reveal.js scripts -->
    <script src="https://unpkg.com/reveal.js@5/dist/reveal.js"></script>
    <script src="https://unpkg.com/reveal.js@5/plugin/markdown/markdown.js"></script>
    <script src="https://unpkg.com/reveal.js@5/plugin/highlight/highlight.js"></script>
    <script src="https://unpkg.com/reveal.js@5/plugin/notes/notes.js"></script>
    
    <!-- Mermaid for diagrams -->
    <script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>

    <!-- Site scripts for theme switching -->
    {% include assets/scripts.html %}

    <script>
        // Theme switching + Mermaid integration
        let mermaidInitialized = false;

        function updateRevealTheme() {
            const isDark = document.documentElement.getAttribute('data-bs-theme') === 'dark';
            const darkTheme = document.getElementById('theme-dark');
            const lightTheme = document.getElementById('theme-light');
            if (!darkTheme || !lightTheme) return;
            darkTheme.disabled = !isDark;
            lightTheme.disabled = isDark;
        }

        async function processMermaid(selectorScope) {
            if (typeof mermaid === 'undefined') return;
            const scope = selectorScope || document;
            const allNodes = Array.from(scope.querySelectorAll('.mermaid'));
            if (allNodes.length === 0) return;

            // Only process nodes once; avoid re-parsing already-rendered SVG
            const nodes = allNodes.filter(n => !n.dataset.mermaidProcessed && !n.querySelector('svg'));
            if (nodes.length === 0) return;

            // Normalize Markdown-wrapped Mermaid blocks (<p>...</p>) back to raw text
            for (const node of nodes) {
                const source = (node.textContent || '').trim();
                if (!source) continue;
                node.innerHTML = source;
            }

            try {
                if (typeof mermaid.run === 'function') {
                    await Promise.resolve(mermaid.run({ nodes }));
                } else if (typeof mermaid.init === 'function') {
                    await Promise.resolve(mermaid.init(undefined, nodes));
                }
                for (const node of nodes) node.dataset.mermaidProcessed = 'true';
            } catch (err) {
                // Prevent unhandled promise rejections from bubbling
                console.error('Mermaid render error:', err);
            }
        }

        function initializeMermaid() {
            if (typeof mermaid === 'undefined' || mermaidInitialized) return;
            const isDark = document.documentElement.getAttribute('data-bs-theme') === 'dark';
            try {
                mermaid.initialize({
                    startOnLoad: false,
                    theme: isDark ? 'dark' : 'default',
                    securityLevel: 'loose',
                    flowchart: { useMaxWidth: true, htmlLabels: true }
                });
                mermaidInitialized = true;
            } catch (err) {
                console.error('Mermaid initialization failed:', err);
            }
        }

        // Observe theme changes (do not re-initialize; just swap Reveal theme CSS)
        const observer = new MutationObserver(mutations => {
            for (const m of mutations) {
                if (m.type === 'attributes' && m.attributeName === 'data-bs-theme') {
                    updateRevealTheme();
                }
            }
        });
        observer.observe(document.documentElement, { attributes: true, attributeFilter: ['data-bs-theme'] });
        updateRevealTheme();
    </script>

    <script>
        // Reveal initialization with Mermaid integration
        function initializeReveal() {
            if (!(typeof Reveal !== 'undefined' && typeof RevealMarkdown !== 'undefined')) {
                return setTimeout(initializeReveal, 100);
            }
            try {
                initializeMermaid();
                const initResult = Reveal.initialize({
                    hash: true,
                    slideNumber: true,
                    plugins: [RevealMarkdown, RevealHighlight, RevealNotes],
                    width: 1280,
                    height: 720,
                    controls: true,
                    progress: true,
                    center: true,
                    hashOneBasedIndex: false,
                    ready: () => {
                        processMermaid();
                        if (Reveal.getIndices().h !== 0 || Reveal.getIndices().v !== 0) {
                            Reveal.slide(0,0);
                        }
                    }
                });
                Reveal.on('slidechanged', e => {
                    // Re-render mermaid only for current slide to reduce overhead
                    processMermaid(e.currentSlide);
                });
            } catch (err) {
                console.error('Reveal init error:', err);
            }
        }
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeReveal);
        } else {
            initializeReveal();
        }
    </script>

    <!-- Bootstrap core JavaScript -->
    {% include assets/js-bottom-of-body.html %}
    <script>
        // Fallback: if Reveal failed after 3s, unhide raw slide content for debugging.
        setTimeout(() => {
            if (typeof Reveal === 'undefined' || !document.querySelector('.reveal .slides section')) {
                console.warn('Reveal fallback activated: showing raw content');
                const container = document.querySelector('.reveal');
                if (container) { container.style.opacity = '1'; }
            }
        }, 3000);
    </script>
</body>

</html>