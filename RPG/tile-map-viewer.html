<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hexagon Tile Map Viewer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            background-color: #222;
            color: #fff;
        }
        #map-container {
            margin: 20px;
            position: relative;
        }
        #map-canvas {
            border: 2px solid #444;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        .instructions {
            margin: 10px;
            padding: 10px;
            background-color: #333;
            border-radius: 5px;
        }
        .controls {
            margin: 10px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        .hex-controls {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .key-row {
            display: flex;
            justify-content: center;
        }
        .key {
            background-color: #444;
            padding: 5px 10px;
            border-radius: 4px;
            margin: 0 5px;
            min-width: 20px;
            text-align: center;
        }
        #map-controls {
            margin: 20px;
            padding: 10px;
            background-color: #333;
            border-radius: 5px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            background-color: #555;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #777;
        }
        select {
            padding: 8px;
            background-color: #444;
            color: white;
            border: none;
            border-radius: 4px;
        }
    </style>
    <!-- Include the map generator script -->
    <script src="js/mapGenerator.js"></script>
</head>
<body>
    <h1>Hexagon Tile Map Viewer</h1>
    <div class="instructions">
        <p>Use keyboard to navigate the hexagonal map</p>
    </div>
    <div id="map-controls">
        <label for="map-type">Map Type:</label>
        <select id="map-type">
            <option value="island">Island</option>
            <option value="continent">Continent</option>
            <option value="archipelago">Archipelago</option>
            <option value="desert">Desert Wasteland</option>
            <option value="forest">Deep Forest</option>
            <option value="jungle">Tropical Jungle</option>
        </select>
        <button id="generate-map">Generate New Map</button>
    </div>
    <div id="map-container">
        <canvas id="map-canvas" width="512" height="512"></canvas>
    </div>
    <div class="controls">
        <div class="hex-controls">
            <div class="key-row">
                <span class="key">Q</span>
                <span class="key">W</span>
                <span class="key">E</span>
            </div>
            <div class="key-row">
                <span class="key">A</span>
                <span class="key">S</span>
                <span class="key">D</span>
            </div>
        </div>
        <div>for hexagonal movement</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('map-canvas');
            const ctx = canvas.getContext('2d');
            
            // Hexagon dimensions
            const HEX_SIZE = 28; // Distance from center to corner
            const HEX_WIDTH = HEX_SIZE * Math.sqrt(3);
            const HEX_HEIGHT = HEX_SIZE * 2;
            const HEX_SIDE = HEX_SIZE;
            const HEX_VERT_DIST = HEX_HEIGHT * 0.75; // Vertical distance between hex centers
            
            // Map dimensions
            const MAP_WIDTH = 64;
            const MAP_HEIGHT = 64;
            
            // Calculate display dimensions (how many hexes fit on screen)
            const DISPLAY_WIDTH = Math.floor(canvas.width / (HEX_WIDTH)) + 1;
            const DISPLAY_HEIGHT = Math.floor(canvas.height / HEX_VERT_DIST) + 1;
            
            // Variables to track viewport position - start at the center of the map
            let viewX = Math.floor(MAP_WIDTH/2 - DISPLAY_WIDTH/2);
            let viewY = Math.floor(MAP_HEIGHT/2 - DISPLAY_HEIGHT/2);
            
            // Tile types and their corresponding image paths
            const tileTypes = [
                "000_deep_water.png",
                "001_medium_water.png",
                "002_shallow_water.png",
                "003_swamp.png",
                "004_grass.png",
                "005_scrub.png",
                "006_forest.png",
                "007_hill.png",
                "008_mountain.png",
                "009_dungeon.png",
                "010_town.png",
                "011_keep.png",
                "012_village.png",
                "257_desert.png",
                "258_plateau.png",
                "259_jungle.png",
            ];
            
            // Create an array to hold the tile images
            const tileImages = [];
            
            // Current map data
            let map = [];
            
            // Load all tile images before drawing
            let loadedImages = 0;
            tileTypes.forEach((tileName, index) => {
                const img = new Image();
                img.src = `https://tedt.org/RPG/images/U4/32x32x24/shapes-assets/${tileName}`;
                img.onload = () => {
                    loadedImages++;
                    // Once all images are loaded, draw the map
                    if (loadedImages === tileTypes.length) {
                        // Get initial map type
                        const mapTypeSelect = document.getElementById('map-type');
                        map = MapGenerator.generateMap(mapTypeSelect.value, MAP_WIDTH, MAP_HEIGHT);
                        drawMap();
                    }
                };
                tileImages[index] = img;
            });
            
            // Event listener for map type selection and generation
            document.getElementById('generate-map').addEventListener('click', () => {
                const mapType = document.getElementById('map-type').value;
                map = MapGenerator.generateMap(mapType, MAP_WIDTH, MAP_HEIGHT);
                
                // Reset view to center of map
                viewX = Math.floor(MAP_WIDTH/2 - DISPLAY_WIDTH/2);
                viewY = Math.floor(MAP_HEIGHT/2 - DISPLAY_HEIGHT/2);
                
                drawMap();
            });
            
            // Function to draw a hexagon at a given position
            function drawHexagon(x, y, tileImage) {
                // Calculate the center position of the hexagon
                const offsetX = y % 2 === 0 ? 0 : HEX_WIDTH / 2;
                const centerX = x * HEX_WIDTH + offsetX;
                const centerY = y * HEX_VERT_DIST;
                
                // Draw the tile image clipped to a hexagon shape
                ctx.save();
                
                // Create a hexagon path
                ctx.beginPath();
                for (let i = 0; i < 6; i++) {
                    const angle = (i * Math.PI / 3) + Math.PI / 6; // +30Â° to make flat-topped
                    const hx = centerX + HEX_SIZE * Math.cos(angle);
                    const hy = centerY + HEX_SIZE * Math.sin(angle);
                    
                    if (i === 0) {
                        ctx.moveTo(hx, hy);
                    } else {
                        ctx.lineTo(hx, hy);
                    }
                }
                ctx.closePath();
                
                // Clip to the hexagon shape and draw the image
                ctx.clip();
                
                // Draw the tile image
                const imgSize = Math.max(HEX_WIDTH, HEX_HEIGHT) * 1.1; // Make slightly larger to avoid gaps
                ctx.drawImage(
                    tileImage,
                    centerX - imgSize / 2,
                    centerY - imgSize / 2,
                    imgSize,
                    imgSize
                );
                
                ctx.restore();
            }
            
            // Function to draw the visible portion of the map
            function drawMap() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw visible hexagons
                for (let y = 0; y < DISPLAY_HEIGHT + 1; y++) {
                    for (let x = 0; x < DISPLAY_WIDTH + 1; x++) {
                        const mapX = x + viewX;
                        const mapY = y + viewY;
                        
                        // Make sure we're within map bounds
                        if (mapX >= 0 && mapX < MAP_WIDTH && mapY >= 0 && mapY < MAP_HEIGHT) {
                            const tileType = map[mapY][mapX];
                            drawHexagon(x, y, tileImages[tileType]);
                        }
                    }
                }
            }
            
            // Handle keyboard input for hexagonal movement
            document.addEventListener('keydown', (e) => {
                // Store original position to check if it changed
                const originalX = viewX;
                const originalY = viewY;
                
                // Axial coordinate movement for flat-topped hexagons
                // Odd rows are offset horizontally
                const oddRow = viewY % 2 !== 0;
                
                switch (e.key.toLowerCase()) {
                    case 'w': // Up-right
                        viewY = Math.max(0, viewY - 1);
                        if (!oddRow) viewX = Math.min(MAP_WIDTH - 1, viewX + 1);
                        break;
                    case 'q': // Up-left
                        viewY = Math.max(0, viewY - 1);
                        if (oddRow) viewX = Math.max(0, viewX - 1);
                        break;
                    case 's': // Down
                        viewY = Math.min(MAP_HEIGHT - 1, viewY + 1);
                        break;
                    case 'a': // Left
                        viewX = Math.max(0, viewX - 1);
                        break;
                    case 'd': // Right
                        viewX = Math.min(MAP_WIDTH - 1, viewX + 1);
                        break;
                    case 'e': // Up
                        viewY = Math.max(0, viewY - 1);
                        break;
                    // Keep arrow keys too for easier movement
                    case 'arrowup':
                        viewY = Math.max(0, viewY - 1);
                        break;
                    case 'arrowdown':
                        viewY = Math.min(MAP_HEIGHT - 1, viewY + 1);
                        break;
                    case 'arrowleft':
                        viewX = Math.max(0, viewX - 1);
                        break;
                    case 'arrowright':
                        viewX = Math.min(MAP_WIDTH - 1, viewX + 1);
                        break;
                }
                
                // Apply viewport bounds
                viewX = Math.min(Math.max(0, viewX), MAP_WIDTH - DISPLAY_WIDTH);
                viewY = Math.min(Math.max(0, viewY), MAP_HEIGHT - DISPLAY_HEIGHT);
                
                // Redraw the map if position changed
                if (originalX !== viewX || originalY !== viewY) {
                    drawMap();
                    e.preventDefault(); // Prevent browser scrolling
                }
            });
            
            // Initial loading message
            ctx.fillStyle = "#444";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#fff";
            ctx.font = "20px Arial";
            ctx.textAlign = "center";
            ctx.fillText("Loading map tiles...", canvas.width / 2, canvas.height / 2);
        });
    </script>
</body>
</html>
