<!DOCTYPE html>
<html>
  <head>
    <title>Fractal World Generator v1.0.2</title>
    <script type="text/javascript">
// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
// this is a completely self-contained random world generator,
// implemented in HTML5 and JavaScript.
//
//   version 1.0.2      es2015 updates
//   version 1.0.1      updated save_canvas to use filename
//   version 1.0        initial release
//
// written by drow [drow@bin.sh]
// http://creativecommons.org/licenses/by-nc/3.0/

// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
// config functions

    function random (n) { 
        return Math.floor(Math.random() * n); 
    }

// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
// configuration

  let default_query = {
    'seed':             Date.now(),
    'projection':       'square',
    'palette':          'atlas',
    'pct_water':        random(50) + 25,
    'pct_ice':          random(10) + 5,
    'height':           400,
    'iter':             5000,
    'rotate':            0,
    'terrain_variation': 75, // Default terrain variation value (75%)
    'algorithm':        'voss_a7', // Default algorithm
    'erode':            true, // Default erosion setting
    'horizontal_factor': 0.5, // Default horizontal distortion factor
    'vertical_factor':   0.2, // Default vertical distortion factor
    'enable_hack_theta': true // Default theta hack setting
  };
  let max_height      = 1000;
  let max_iter        = 25000;

// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
// palettes

  let palette = {
    'olsson': {                         // john olsson
      'title':          'Olsson',
      'sea': [
        [0x00,0x00,0x44], [0x00,0x11,0x66], [0x00,0x33,0x88],
        [0x00,0x55,0xAA], [0x00,0x77,0xBB], [0x00,0x99,0xDD],
        [0x00,0xCC,0xFF], [0x22,0xDD,0xFF], [0x44,0xEE,0xFF],
        [0x66,0xFF,0xFF], [0x77,0xFF,0xFF], [0x88,0xFF,0xFF],
        [0x99,0xFF,0xFF], [0xAA,0xFF,0xFF], [0xBB,0xFF,0xFF]
      ],
      'land': [
        [0x00,0x44,0x00], [0x22,0x66,0x00], [0x22,0x88,0x00],
        [0x77,0xAA,0x00], [0xBB,0xDD,0x00], [0xFF,0xBB,0x22],
        [0xEE,0xAA,0x22], [0xDD,0x88,0x22], [0xCC,0x88,0x22],
        [0xBB,0x66,0x22], [0xAA,0x55,0x22], [0x99,0x55,0x22],
        [0x88,0x44,0x22], [0x77,0x33,0x22], [0x55,0x33,0x11],
        [0x44,0x22,0x00]
      ]
    },
    'mogensen': {                       // toben mogensen
      'title':          'Mogensen',
      'sea': [
        [0x00,0x00,0xC0], [0x00,0x09,0xC4], [0x00,0x12,0xC9],
        [0x00,0x1B,0xCD], [0x00,0x24,0xD2], [0x00,0x2D,0xD6],
        [0x00,0x36,0xDB], [0x00,0x40,0xDF], [0x00,0x49,0xE4],
        [0x00,0x52,0xE8], [0x00,0x5B,0xED], [0x00,0x64,0xF1],
        [0x00,0x6D,0xF6], [0x00,0x76,0xFA], [0x00,0x80,0xFF]
      ],
      'land': [
        [0x00,0x60,0x00], [0x00,0x80,0x00], [0x00,0xA0,0x00],
        [0x00,0xC0,0x00], [0x00,0xE0,0x00], [0x20,0xD4,0x00],
        [0x40,0xC8,0x00], [0x60,0xBC,0x00], [0x80,0xB0,0x00],
        [0x80,0xA4,0x20], [0x80,0x98,0x40], [0x80,0x8C,0x60],
        [0x80,0x80,0x80], [0xAA,0xAA,0xAA], [0xD4,0xD4,0xD4],
        [0xFF,0xFF,0xFF]
      ]
    },
    'atlas': {
      'title':          'Atlas',
      'sea': [
        [0x80,0xB0,0xBD], [0x86,0xB5,0xC1], [0x8D,0xBA,0xC6],
        [0x94,0xBF,0xCA], [0x9A,0xC4,0xCF], [0xA1,0xC9,0xD4],
        [0xA8,0xCE,0xD8], [0xAF,0xD3,0xDD], [0xB5,0xD8,0xE2],
        [0xBC,0xDD,0xE6], [0xC3,0xE2,0xEB], [0xCA,0xE8,0xF0],
        [0xCA,0xE8,0xF0], [0xCA,0xE8,0xF0], [0xCA,0xE8,0xF0]
      ],
      'land': [
        [0x84,0xB6,0x77], [0x93,0xBD,0x80], [0xA2,0xC5,0x8A],
        [0xB1,0xCC,0x93], [0xC0,0xD4,0x9D], [0xCF,0xDB,0xA6],
        [0xDE,0xE3,0xB0], [0xED,0xEB,0xBA], [0xE0,0xD9,0xAF],
        [0xD3,0xC7,0xA3], [0xC6,0xB5,0x98], [0xB9,0xA3,0x8C],
        [0xCA,0xBA,0xA8], [0xDC,0xD1,0xC5], [0xED,0xE8,0xE2],
        [0xFF,0xFF,0xFF]
      ]
    },
    'antique': {
      'title':          'Antique',
      'set':            { 'pct_ice': 0 },
      'sea': [
        [0xEB,0xD2,0xB0], [0xE8,0xD0,0xAE], [0xE5,0xCD,0xAC],
        [0xE2,0xCA,0xAA], [0xDF,0xC8,0xA7], [0xDC,0xC5,0xA5],
        [0xD9,0xC2,0xA3], [0xD6,0xC0,0xA0],
        [0xD3,0xBD,0x9E], [0xD0,0xBA,0x9C], [0xCC,0xB7,0x99],
        [0x99,0x8A,0x73], [0x66,0x5C,0x4D], [0x33,0x2E,0x27],
        [0x00,0x00,0x00]
      ],
      'land': [
        [0xE2,0xCA,0xAA], [0xE2,0xCA,0xAA], [0xE3,0xCB,0xAA],
        [0xE3,0xCB,0xAB], [0xE4,0xCC,0xAB], [0xE5,0xCC,0xAC],
        [0xE5,0xCD,0xAC], [0xE6,0xCD,0xAC], [0xE6,0xCE,0xAD],
        [0xE7,0xCE,0xAD], [0xE8,0xCF,0xAE], [0xE8,0xCF,0xAE],
        [0xE9,0xD0,0xAE], [0xE9,0xD0,0xAF], [0xEA,0xD1,0xAF],
        [0xEB,0xD2,0xB0]
      ]
    },
    'barren': {
      'title':          'Barren',
      'sea': [
        [0x00,0x00,0xC0], [0x00,0x09,0xC4], [0x00,0x12,0xC9],
        [0x00,0x1B,0xCD], [0x00,0x24,0xD2], [0x00,0x2D,0xD6],
        [0x00,0x36,0xDB], [0x00,0x40,0xDF], [0x00,0x49,0xE4],
        [0x00,0x52,0xE8], [0x00,0x5B,0xED], [0x00,0x64,0xF1],
        [0x00,0x6D,0xF6], [0x00,0x76,0xFA], [0x00,0x80,0xFF]
      ],
      'land': [
        [0x94,0x64,0x52], [0xA9,0x74,0x54], [0xBE,0x84,0x56],
        [0xD3,0x94,0x58], [0xE8,0xA4,0x5A], [0xEC,0xA8,0x5A],
        [0xF0,0xAC,0x5B], [0xF4,0xB0,0x5B], [0xF8,0xB4,0x5C],
        [0xE4,0xA7,0x60], [0xCF,0x9A,0x64], [0xBA,0x8D,0x68],
        [0xA5,0x80,0x6C], [0xC3,0xAA,0x9D], [0xE1,0xD4,0xCE],
        [0xFF,0xFF,0xFF]
      ]
    },
    'martian': {
      'title':          'Martian',
      'set':            { 'pct_water': 0 },
      'sea': [
        [0x00,0x00,0xC0], [0x00,0x09,0xC4], [0x00,0x12,0xC9],
        [0x00,0x1B,0xCD], [0x00,0x24,0xD2], [0x00,0x2D,0xD6],
        [0x00,0x36,0xDB], [0x00,0x40,0xDF], [0x00,0x49,0xE4],
        [0x00,0x52,0xE8], [0x00,0x5B,0xED], [0x00,0x64,0xF1],
        [0x00,0x6D,0xF6], [0x00,0x76,0xFA], [0x00,0x80,0xFF]
      ],
      'land': [
        [0x94,0x64,0x52], [0xA9,0x74,0x54], [0xBE,0x84,0x56],
        [0xD3,0x94,0x58], [0xE8,0xA4,0x5A], [0xEC,0xA8,0x5A],
        [0xF0,0xAC,0x5B], [0xF4,0xB0,0x5B], [0xF8,0xB4,0x5C],
        [0xE4,0xA7,0x60], [0xCF,0x9A,0x64], [0xBA,0x8D,0x68],
        [0xA5,0x80,0x6C], [0xC3,0xAA,0x9D], [0xE1,0xD4,0xCE],
        [0xFF,0xFF,0xFF]
      ]
    },
    'chthonian': {
      'title':          'Chthonian',
      'set':            { 'pct_ice': 0 },
      'sea': [
        [0xFB,0xE7,0x2E], [0xFB,0xC3,0x2C], [0xFC,0x9E,0x29],
        [0xFD,0x7A,0x27], [0xFE,0x55,0x24], [0xF8,0x4D,0x21],
        [0xF2,0x44,0x1D], [0xEC,0x3C,0x1A], [0xE6,0x33,0x16],
        [0xDF,0x2B,0x12], [0xD9,0x22,0x0F], [0xD3,0x1A,0x0B],
        [0xCD,0x11,0x08], [0xC7,0x09,0x04], [0xC0,0x00,0x00]
      ],
      'land': [
        [0x10,0x10,0x10], [0x14,0x14,0x14], [0x18,0x18,0x18],
        [0x1D,0x1D,0x1D], [0x21,0x21,0x21], [0x25,0x25,0x25],
        [0x2A,0x2A,0x2A], [0x2E,0x2E,0x2E], [0x32,0x32,0x32],
        [0x37,0x37,0x37], [0x3B,0x3B,0x3B], [0x40,0x40,0x40],
        [0x50,0x50,0x50], [0x60,0x60,0x60], [0x70,0x70,0x70],
        [0x80,0x80,0x80]
      ]
    },
    'greyscale': {
      'title':          'Greyscale',
      'set':            { 'pct_water': 0, 'pct_ice': 0 },
      'sea': [
        [0x00,0x00,0xC0], [0x00,0x09,0xC4], [0x00,0x12,0xC9],
        [0x00,0x1B,0xCD], [0x00,0x24,0xD2], [0x00,0x2D,0xD6],
        [0x00,0x36,0xDB], [0x00,0x40,0xDF], [0x00,0x49,0xE4],
        [0x00,0x52,0xE8], [0x00,0x5B,0xED], [0x00,0x64,0xF1],
        [0x00,0x6D,0xF6], [0x00,0x76,0xFA], [0x00,0x80,0xFF]
      ],
      'land': [
        [0x40,0x40,0x40], [0x48,0x48,0x48], [0x51,0x51,0x51],
        [0x59,0x59,0x59], [0x62,0x62,0x62], [0x6A,0x6A,0x6A],
        [0x73,0x73,0x73], [0x7B,0x7B,0x7B], [0x84,0x84,0x84],
        [0x8C,0x8C,0x8C], [0x95,0x95,0x95], [0x9D,0x9D,0x9D],
        [0xA6,0xA6,0xA6], [0xAE,0xAE,0xAE], [0xB7,0xB7,0xB7],
        [0xC0,0xC0,0xC0]
      ]
    },
    'landmask': {
      'title':          'Landmask',
      'set':            { 'pct_ice': 0 },
      'sea': [
        [0x00,0x00,0x00], [0x00,0x00,0x00], [0x00,0x00,0x00],
        [0x00,0x00,0x00], [0x00,0x00,0x00], [0x00,0x00,0x00],
        [0x00,0x00,0x00], [0x00,0x00,0x00], [0x00,0x00,0x00],
        [0x00,0x00,0x00], [0x00,0x00,0x00], [0x00,0x00,0x00],
        [0x00,0x00,0x00], [0x00,0x00,0x00], [0x00,0x00,0x00]
      ],
      'land': [
        [0xFF,0xFF,0xFF], [0xFF,0xFF,0xFF], [0xFF,0xFF,0xFF],
        [0xFF,0xFF,0xFF], [0xFF,0xFF,0xFF], [0xFF,0xFF,0xFF],
        [0xFF,0xFF,0xFF], [0xFF,0xFF,0xFF], [0xFF,0xFF,0xFF],
        [0xFF,0xFF,0xFF], [0xFF,0xFF,0xFF], [0xFF,0xFF,0xFF],
        [0xFF,0xFF,0xFF], [0xFF,0xFF,0xFF], [0xFF,0xFF,0xFF],
        [0xFF,0xFF,0xFF]
      ]
    }
  };
    </script>
    <style>
        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
        /* structure */

        body { margin: 0px; padding: 0px;
            font-family: 'Asul', sans-serif; font-size: 14px; 
        }

        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
        /* common */

        h1 { 
            text-align: center; font-size: 150%; font-weight: bold; 
        }

        form { 
            margin: 2ex 2em; padding: 0px; 
        }
        input { margin-right: 0.5em; padding: 0.5ex 0.5em;
            font-family: Monaco, monospace; font-size: 11px; 
        }
        select {
             min-width: 10em; margin-right: 0.5em; font-size: 11px; 
        }

        table {
            margin: 0px 2em; border: none; border-collapse: collapse; 
        }
        td {
            padding: 0.5ex 0.5em; text-align: left; vertical-align: top; 
        }
        td.key {
            text-align: right; font-weight: bold; 
        }

        canvas {
            margin: 2ex auto; 
        }

        .center {
            text-align: center; 
        }

        table.center {
            margin-left: auto; margin-right: auto;
        }

        /* Slider styles */
        .slider-container {
            display: flex;
            align-items: center;
        }
        
        .slider {
            flex-grow: 1;
            margin-right: 10px;
        }
        
        .slider-value {
            width: 30px;
            text-align: center;
        }

        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
        /* screen */

        @media screen {
            h1.title { display: none; }
            form { display: block; }
        }

        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
        /* print */

        @media print {
            h1.title { display: block; }
            form, .control { display: none; }
        }

        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */


    </style>
  </head>
  <body>
    <form class="scripted">
      <h1>Fractal World Generator</h1>
      <table id="form" class="center">
        <tr>
          <td class="key">Random Seed:</td>
          <td colspan="5" class="value"><input id="seed" size="20" /> &nbsp; <input type="button" id="new_seed" value="New" /> </td>
        </tr>
        <tr>
          <td class="key">Projection:</td>
          <td class="value"><select id="projection"></select></td>
          <td class="key">Palette:</td>
          <td class="value"><select id="palette"></select></td>
        </tr>
        <tr>
          <td class="key">% Water:</td>
          <td class="value"><input id="pct_water" size="5" /></td>
          <td class="key">% Ice:</td>
          <td class="value"><input id="pct_ice" size="5" /></td>
        </tr>
        <tr>
          <td class="key">Height:</td>
          <td class="value"><input id="height" size="5" /></td>
          <td class="key">Iterations:</td>
          <td class="value"><input id="iter" size="5" /></td>
          <td class="key">Rotate:</td>
          <td class="value"><input id="rotate" size="5" /></td>
        </tr>
        <tr>
          <td class="key">Terrain Variation:</td>
          <td colspan="5" class="value">
            <div class="slider-container">
              <input type="range" id="terrain_variation" min="0" max="100" step="1" class="slider" value="75" />
              <span id="terrain_variation_value" class="slider-value">75%</span>
            </div>
          </td>
        </tr>
        <tr>
          <td class="key">Algorithm:</td>
          <td class="value">
            <select id="algorithm">
              <option value="voss">Basic Voss</option>
              <option value="voss_x3">Voss x3</option>
              <option value="voss_a7" selected>Voss a7</option>
            </select>
          </td>
          <td class="key">Apply Erosion:</td>
          <td class="value"><input type="checkbox" id="erode" checked /></td>
        </tr>
        <tr>
          <td class="key">Enable Theta Hack:</td>
          <td class="value"><input type="checkbox" id="enable_hack_theta" checked /></td>
          <td colspan="4"></td>
        </tr>
        <tr>
          <td class="key">Horizontal Factor:</td>
          <td colspan="5" class="value">
            <div class="slider-container">
              <input type="range" id="horizontal_factor" min="0" max="100" step="1" class="slider" value="50" />
              <span id="horizontal_factor_value" class="slider-value">0.50</span>
            </div>
          </td>
        </tr>
        <tr>
          <td class="key">Vertical Factor:</td>
          <td colspan="5" class="value">
            <div class="slider-container">
              <input type="range" id="vertical_factor" min="0" max="100" step="1" class="slider" value="20" />
              <span id="vertical_factor_value" class="slider-value">0.20</span>
            </div>
          </td>
        </tr>
        <tr>
          <td colspan="6"></td>
        </tr>
        <tr>
          <td colspan="6" class="center" style="background: #dedede;">
            <input id="save_map" type="button" value="Save as PNG" />
            &nbsp; <input id="print_map" type="button" value="Print" />
          </td>
        </tr>
      </table>
    </form>
    <div class="center">
      <canvas id="map" width="1" height="1">
        <p>Your web browser does not appear to support HTML5 canvas.</p>
      </canvas>
      <p class="control"><b>Time:</b> <span id="dt"></span> seconds</p>
      <p>Fractal World Generator based on work at: http://donjon.bin.sh/</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prototype/1.7.3/prototype.js"></script>
    <script src = "js/world.js"></script>
    <script src = "js/canvas.js"></script>
    <script src = "js/custom-seeded-random.js"></script>

    <script>
      // Wait for both DOM and all scripts to be fully loaded
      window.onload = function() {
        // Check if updateMap function exists before setting up event handlers
        if (typeof updateMap !== "function") {
          console.error("Error: updateMap function not available. Make sure world.js is loaded properly.");
          return;
        }
        
        // Set up terrain variation slider
        const terrainSlider = $('terrain_variation');
        const terrainValueDisplay = $('terrain_variation_value');
        
        terrainSlider.observe('input', function() {
          const value = terrainSlider.value;
          terrainValueDisplay.update(value + '%');
          // Don't call updateMap directly here as it might trigger too many redraws
        });

        // Set up terrain variation change event (fires when slider is released)
        terrainSlider.observe('change', updateMap);

        // Set up horizontal factor slider
        const horizontalSlider = $('horizontal_factor');
        const horizontalValueDisplay = $('horizontal_factor_value');
        
        horizontalSlider.observe('input', function() {
          const value = (horizontalSlider.value / 100).toFixed(2);
          horizontalValueDisplay.update(value);
          // Don't call updateMap directly here
        });
        
        // Horizontal factor change event
        horizontalSlider.observe('change', updateMap);

        // Set up vertical factor slider
        const verticalSlider = $('vertical_factor');
        const verticalValueDisplay = $('vertical_factor_value');
        
        verticalSlider.observe('input', function() {
          const value = (verticalSlider.value / 100).toFixed(2);
          verticalValueDisplay.update(value);
          // Don't call updateMap directly here
        });
        
        // Vertical factor change event
        verticalSlider.observe('change', updateMap);

        // Set up algorithm dropdown
        $('algorithm').observe('change', updateMap);

        // Set up checkbox events
        $('erode').observe('change', updateMap);
        $('enable_hack_theta').observe('change', updateMap);
      };
    </script>
  </body>
</html>
