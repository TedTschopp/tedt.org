---
layout: page
title: Mastodon Backfill History
permalink: /mastodon-backfill-history/
---

<h1>Mastodon Backfill History</h1>
<p>This page renders the accumulated backfill run history. Only live (non-dry-run) runs reduce the missing count.</p>
<p>Machine-readable snapshot: <a href="/mastodon-backfill-progress.json">/mastodon-backfill-progress.json</a></p>
<p>Summary view: <a href="/mastodon-backfill-summary/">/mastodon-backfill-summary/</a> | Raw markdown: <a href="/Logs/mastodon-backfill-summary.md">/Logs/mastodon-backfill-summary.md</a></p>
{% include utility/masto-backfill-badge.html %}

{%- if site.data.masto_backfill_history -%}
  {%- assign history = site.data.masto_backfill_history -%}
{%- else -%}
  {%- assign history = '' | split: '' -%}
{%- endif -%}
{% if history.size == 0 %}
<p>No history recorded yet.</p>
{% else %}
<table>
  <thead>
    <tr>
      <th>Timestamp (UTC)</th>
      <th>Run ID</th>
      <th>Dry Run</th>
      <th>Delay</th>
      <th>Limit</th>
      <th>Since</th>
      <th>Missing Before</th>
      <th>Missing After</th>
      <th>Processed</th>
      <th>Completion %</th>
    </tr>
  </thead>
  <tbody>
  {% assign initial_missing = history.first.missing_before | plus: 0 %}
  {% for row in history %}
    {% assign processed_total = initial_missing | minus: row.missing_after %}
    {% if initial_missing > 0 %}
      {% assign pct = processed_total | times: 100 | divided_by: initial_missing %}
    {% else %}
      {% assign pct = 0 %}
    {% endif %}
    <tr>
      <td>{{ row.timestamp }}</td>
      <td>{{ row.run_id }}</td>
      <td>{{ row.dry_run }}</td>
      <td>{{ row.delay }}</td>
      <td>{{ row.limit }}</td>
      <td>{{ row.since }}</td>
      <td>{{ row.missing_before }}</td>
      <td>{{ row.missing_after }}</td>
      <td>{{ row.processed }}</td>
      <td>{{ pct }}%</td>
    </tr>
  {% endfor %}
  </tbody>
</table>

<noscript><p>(Full table shown. Enable JavaScript for pagination.)</p></noscript>
<div id="history-pagination" aria-label="Backfill history pagination" class="pagination" data-page-size="50"></div>
<script>
(function(){
  const table = document.querySelector('table');
  if(!table) return;
  const tbody = table.querySelector('tbody');
  const rows = Array.from(tbody.querySelectorAll('tr'));
  const pagerContainer = document.getElementById('history-pagination');
  if(!pagerContainer) return;
  const pageSize = parseInt(pagerContainer.getAttribute('data-page-size')||'50',10);
  if(rows.length <= pageSize) return; // No need
  let current = 0;
  function render(){
    rows.forEach((r,i)=>{ r.style.display = (i >= current*pageSize && i < (current+1)*pageSize) ? '' : 'none'; });
    buildPager();
  }
  function buildPager(){
    const totalPages = Math.ceil(rows.length / pageSize);
    pagerContainer.innerHTML='';
    function btn(label, target, disabled){
      const b=document.createElement('button');
      b.textContent=label; b.type='button'; b.disabled=!!disabled; b.addEventListener('click',()=>{current=target; render();});
      pagerContainer.appendChild(b);
    }
    btn('⟨ Prev', Math.max(0,current-1), current===0);
    for(let i=0;i<totalPages;i++){
      const b=document.createElement('button');
      b.type='button'; b.textContent=(i+1);
      if(i===current) b.setAttribute('aria-current','page');
      b.addEventListener('click',()=>{current=i; render();});
      pagerContainer.appendChild(b);
    }
    btn('Next ⟩', Math.min(totalPages-1,current+1), current===totalPages-1);
  }
  render();
})();
</script>

<h2>Summary</h2>
{% assign last = history.last %}
{% assign current_missing = last.missing_after | plus: 0 %}
{% assign processed_total = initial_missing | minus: current_missing %}
{% if initial_missing > 0 %}
  {% assign pct_overall = processed_total | times: 100 | divided_by: initial_missing %}
{% else %}
  {% assign pct_overall = 0 %}
{% endif %}
<ul>
  <li>Initial missing: {{ initial_missing }}</li>
  <li>Current missing: {{ current_missing }}</li>
  <li>Total processed: {{ processed_total }}</li>
  <li>Completion: {{ processed_total }}/{{ initial_missing }} ({{ pct_overall }}%)</li>
</ul>
{% endif %}
