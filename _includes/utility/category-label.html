{%- comment -%}
  Unified category label renderer (uses category_registry.yml)
  Params:
    category (string) - required raw name or canonical slug
    kind (string) - 'title' | 'badge' (adds category-title or category-badge class for theming bridge)
    as (string) - force element name if no href (default span)
    href (string) - if provided, element becomes an <a>
    class_extra (string) - extra classes appended
    text_override (string) - override visible label
    debug (bool) - append HTML comment with resolution info
  Notes:
    - Adding kind="title" ensures CSS selectors like [data-cat] .category-title apply.
    - Adding kind="badge" enables badge styling; you can wrap externally if needed.
{%- endcomment -%}
{% assign raw_category = include.category | to_s | strip %}
{% assign registry = site.data.category_registry %}
{%- assign __canonical = nil -%}
{%- comment -%} First try direct key (already a slug) {%- endcomment -%}
{% if registry[raw_category] %}
  {% assign __canonical = raw_category %}
{% else %}
  {%- comment -%} Try slugified key early to catch 'Role Playing Games' -> 'role-playing-games' {%- endcomment -%}
  {% assign slug_try = raw_category | slugify %}
  {% if registry[slug_try] %}
    {% assign __canonical = slug_try %}
  {% else %}
  {%- comment -%} Search raw_names arrays case-insensitively {%- endcomment -%}
  {% assign lower = raw_category | downcase %}
  {% for pair in registry %}
    {% assign slug = pair[0] %}
    {% assign data = pair[1] %}
    {% if __canonical %}{% break %}{% endif %}
    {% if data.raw_names %}
      {% for variant in data.raw_names %}
        {% if variant and variant | downcase == lower %}
          {% assign __canonical = slug %}
          {% break %}
        {% endif %}
      {% endfor %}
    {% endif %}
  {% endfor %}
  {% endif %}
{% endif %}
{% if __canonical == nil %}
  {% assign __canonical = raw_category | slugify %}
{% endif %}
{% assign entry = registry[__canonical] %}
{% assign label_text = include.text_override | default: entry.label | default: entry.title | default: raw_category %}
{% assign class_to_add = entry.class | default: __canonical %}
{%- if include.kind == 'title' -%}
  {% assign class_to_add = class_to_add | append: ' category-title' %}
{%- elsif include.kind == 'badge' -%}
  {% assign class_to_add = class_to_add | append: ' category-badge' %}
{%- endif -%}
{% if include.href and include.href != '' %}
  {% assign element = 'a' %}
{% else %}
  {% assign element = include.as | default: 'span' %}
{% endif %}
{% assign inline_style = entry.inline_style %}
<span class="category-theme" data-category="{{ raw_category | escape }}" data-cat="{{ __canonical }}">
  <{{element}} {% if include.href and include.href != '' %}href="{{ include.href }}"{% endif %} class="{{ class_to_add }}{% if include.class_extra %} {{ include.class_extra }}{% endif %}"{% if inline_style and inline_style != '' %} style="{{ inline_style }}"{% endif %}>{{ label_text }}</{{element}}>
</span>{% if include.debug %}<!-- raw:'{{raw_category}}' canonical:'{{__canonical}}' class:'{{class_to_add}}' text:'{{label_text}}' style:'{{inline_style}}' -->{% endif %}
