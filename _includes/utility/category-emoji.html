{%- comment -%}
  Dynamic emoji resolution using unified category_registry.yml
  Supports input as:
    - slug (e.g. 'gamma-world')
    - canonical title (e.g. 'Gamma World')
    - label / variant (e.g. 'Middle-eartH', runic Folklore)
{%- endcomment -%}
{%- assign __input = include.category | to_s | strip -%}
{%- if __input == '' -%}{% comment %} nothing to render {% endcomment %}{% endif %}
{%- assign registry = site.data.category_registry -%}
{%- assign found_slug = nil -%}
{%- assign input_slug = __input | slugify -%}
{%- if registry[input_slug] and input_slug != '' -%}
  {%- assign found_slug = input_slug -%}
{%- else -%}
  {%- comment -%} Iterate to match by title, label, or raw_names variants {%- endcomment -%}
  {%- for pair in registry -%}
    {%- assign slug = pair[0] -%}
    {%- if slug | slice: 0,1 == '$' -%}{%- continue -%}{%- endif -%}
    {%- assign entry = pair[1] -%}
    {%- assign entry_title = entry.title | default: '' -%}
    {%- assign entry_label = entry.label | default: '' -%}
    {%- assign match = false -%}
    {%- if __input == entry_title or __input == entry_label -%}
      {%- assign match = true -%}
    {%- endif -%}
    {%- if match == false and entry.raw_names -%}
      {%- for alt in entry.raw_names -%}
        {%- if __input == alt -%}
          {%- assign match = true -%}
          {%- break -%}
        {%- endif -%}
      {%- endfor -%}
    {%- endif -%}
    {%- if match -%}
      {%- assign found_slug = slug -%}
      {%- break -%}
    {%- endif -%}
  {%- endfor -%}
{%- endif -%}

{%- if found_slug -%}
  {%- assign entry = registry[found_slug] -%}
  {%- assign emoji = entry.emoji | default: '' -%}
  {%- assign title = entry.title | default: __input -%}
  {%- if emoji != '' -%}
    <span class="category-emoji" role="img" aria-label="{{ title }}" title="{{ title }}" data-cat="{{ found_slug }}">{{ emoji }}</span>
  {%- endif -%}
{%- else -%}
  {%- comment -%} Fallback: no match found; intentionally silent to avoid noise {%- endcomment -%}
{%- endif -%}
