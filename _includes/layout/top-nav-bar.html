          <!-- NAVIGATION -->
          {%- comment -%}
            For article (post) pages we force the navbar to remain fixed at the very top of the viewport at all times.
            Rationale: user requirement "articles should always have the top nav bar at the top of the screen".
            Implementation: swap Bootstrap position utility from sticky-top (normal flow until scrolled) to fixed-top (removed from flow).
            NOTE: Post layout body receives extra padding-top (70px) via inline style or global overrides so content is not obscured.
          {%- endcomment -%}
          {%- assign __nav_position_class = 'fixed-top' -%}
          {%- comment -%} Precompute homepage items once to avoid emitting stray text inside any <ul>. {%- endcomment -%}
          {%- assign homepage_cat = site.categories['Home'] -%}
          {%- if homepage_cat -%}
            {%- assign sorted_homepage = homepage_cat | safe_sort: 'order' -%}
          {%- else -%}
            {%- assign sorted_homepage = empty -%}
          {%- endif -%}

          <nav class="navbar navbar-expand-lg {{ __nav_position_class }} bg-dark navbar-dark" role="navigation" aria-label="Primary">
            {%- comment -%}
              Standardized navbar item sizing: ensure all top-level nav links & icon buttons share consistent 44px height,
              vertical centering, and baseline alignment. This improves visual rhythm and accessible hit target size.
            {%- endcomment -%}
            {%- comment -%} Navbar styles extracted to _sass/components/_navbar.scss {%- endcomment -%}

            <div class="container-fluid">
              <a class="navbar-brand u-url" rel="me" href="{{ site.url }}">
                <img src="{{ site.url }}/img/home/logo-Tschopp.svg" height="64" width="64" alt="Ted Tschopp home">
              </a>

              <button
                class="navbar-toggler"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbarNavDarkDropdown"
                aria-controls="navbarNavDarkDropdown"
                aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>

              <div class="collapse navbar-collapse flex-grow-1 text-right" id="navbarNavDarkDropdown">
                <div class="navbar-nav ms-auto" role="list">
                  <div class="nav-item" role="listitem">
                    <button
                      type="button"
                      class="nav-link mx-2 menu-item btn btn-link p-0 border-0 js-nav-button"
                      data-href="{{ site.url }}/profile/"
                      style="text-decoration-thickness: 1px;"
                      aria-label="Go to Profile page">Profile</button>
                    <noscript>
                      <a href="{{ site.url }}/profile/" class="visually-hidden">Profile</a>
                    </noscript>
                  </div>

                  <div class="nav-item dropdown dropdown-center" role="listitem">
                    {%- comment -%}
                      Accessibility: Use a real <button> element for dropdown toggle (anchors previously failed axe label
                      semantics and aria-expanded updates intermittently). Unique IDs per dropdown to avoid duplicate
                      aria-labelledby relationships.
                    {%- endcomment -%}

                    <button
                      type="button"
                      class="nav-link mx-2 menu-item dropdown-toggle btn btn-link p-0 border-0"
                      id="careerDropdownToggle"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                      style="text-decoration-thickness: 1px;">Career</button>

                    <ul class="dropdown-menu-end dropdown-menu dropdown-menu-dark" aria-labelledby="careerDropdownToggle">
                      {%- assign last_company = "" -%}
                      {%- assign new_company = false -%}

                      {%- for post in sorted_homepage -%}
                        {%- for tag in post.tags -%}
                          {%- if post.company != blank and post.company != null -%}
                            {%- if post.company != last_company and last_company != "" -%}
                              {%- assign new_company = true -%}
                            {%- else -%}
                              {%- assign new_company = false -%}
                            {%- endif -%}
                            {%- assign watermark = post.company -%}
                            {%- assign last_company = post.company -%}
                          {%- else -%}
                            {%- assign watermark = "no-watermark" -%}
                          {%- endif -%}

                          {%- if tag == 'Resume' -%}
                            {%- assign this-post-title = post.title -%}
                          {%- else -%}
                            {%- assign this-post-title = post.title -%}
                          {%- endif -%}

                          {%- if tag == 'Resume' -%}
                            {%- if new_company -%}
                              <li><hr class="dropdown-divider"></li>
                            {%- endif -%}

                            {%- if watermark != "no-watermark" -%}
                              <li>
                                <a class="dropdown-item" href="{{ site.url }}/#{{ post.title | slugify}}" style="text-decoration-thickness: 1px;">
                                  <img src="/img/home/logo-{{watermark}}.webp" alt="Company Logo for {{watermark}}" style="height: 1.5em;">
                                  - {{ this-post-title }}
                                </a>
                              </li>
                            {%- else -%}
                              <li>
                                <a class="dropdown-item" href="{{ site.url }}/#{{ post.title | slugify}}" style="text-decoration-thickness: 1px;">
                                  {{ this-post-title }}
                                </a>
                              </li>
                            {%- endif -%}
                          {%- endif -%}
                        {%- endfor -%}
                      {%- endfor -%}
                    </ul>
                  </div>

                  <div class="nav-item dropdown" role="listitem">
                    <button
                      class="nav-link mx-2 menu-item dropdown-toggle btn btn-link p-0 border-0"
                      id="projectsDropdownToggle"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                      style="text-decoration-thickness: 1px;">Projects</button>

                    <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end" aria-labelledby="projectsDropdownToggle">
                      {%- assign last_company = "" -%}
                      {%- assign new_company = false -%}
                      {%- assign first_entry = true -%}

                      {%- for post in sorted_homepage -%}
                        {%- for tag in post.tags -%}
                          {%- if post.company != blank and post.company != null -%}
                            {%- if post.company != last_company and last_company != "" -%}
                              {%- assign new_company = true -%}
                            {%- else -%}
                              {%- assign new_company = false -%}
                            {%- endif -%}
                            {%- assign watermark = post.company -%}
                            {%- assign last_company = post.company -%}
                          {%- else -%}
                            {%- assign watermark = "no-watermark" -%}
                          {%- endif -%}

                          {%- if tag == 'Project' -%}
                            {%- assign this-post-title = post.title -%}
                            {%- if new_company and first_entry != true -%}
                              <li><hr class="dropdown-divider"></li>
                            {%- endif -%}

                            {%- if watermark != "no-watermark" -%}
                              <li>
                                <a class="dropdown-item" href="{{ site.url }}/#{{ post.title | slugify}}" style="text-decoration-thickness: 1px;">
                                  <img src="/img/home/logo-{{watermark}}.webp" alt="Company Logo for {{watermark}}" style="height: 1.5em;">
                                  - {{ this-post-title }}
                                </a>
                              </li>
                            {%- else -%}
                              <li>
                                <a class="dropdown-item" href="{{ site.url }}/#{{ post.title | slugify}}" style="text-decoration-thickness: 1px;">
                                  {{ this-post-title }}
                                </a>
                              </li>
                            {%- endif -%}

                            {%- assign first_entry = false -%}
                          {%- endif -%}
                        {%- endfor -%}
                      {%- endfor -%}
                    </ul>
                  </div>

                  <div class="nav-item" role="listitem">
                    <button
                      type="button"
                      class="nav-link mx-2 menu-item btn btn-link p-0 border-0 js-nav-button"
                      data-href="{{ site.url }}/tools/"
                      style="text-decoration-thickness: 1px;"
                      aria-label="Go to Tools page">
                      Tools {% include utility/stage-badge.html stage="alpha" %}
                    </button>
                    <noscript>
                      <a href="{{ site.url }}/tools/" class="visually-hidden" title="{{ site.data.stages.beta.tooltip }}">Tools</a>
                    </noscript>
                  </div>


                  <div class="nav-item" role="listitem">
                    <button
                      type="button"
                      class="nav-link mx-2 menu-item btn btn-link p-0 border-0 js-nav-button"
                      data-href="{{ site.url }}/slides/"
                      style="text-decoration-thickness: 1px;"
                      aria-label="Go to Presentations page">
                      Presentations {% include utility/stage-badge.html stage="beta" %}
                    </button>
                    <noscript>
                      <a href="{{ site.url }}/slides/" class="visually-hidden" title="{{ site.data.stages.beta.tooltip }}">Presentations</a>
                    </noscript>
                  </div>

                  <div class="nav-item" role="listitem">
                    <button
                      type="button"
                      class="nav-link mx-2 menu-item btn btn-link p-0 border-0 js-nav-button"
                      data-href="{{ site.url }}/prompts/"
                      style="text-decoration-thickness: 1px;"
                      aria-label="Go to Prompts page">
                      Prompts {% include utility/stage-badge.html stage="gamma" %}
                    </button>
                    <noscript>
                      <a href="{{ site.url }}/prompts/" class="visually-hidden" title="{{ site.data.stages.gamma.tooltip }}">Prompts</a>
                    </noscript>
                  </div>

                  <div class="nav-item" role="listitem">
                    <div id="colorSchemeToggle" class="scheme-switcher mx-2" role="group" aria-label="Color scheme">
                      <button type="button" class="scheme-switcher__button" title="Light" aria-label="Light" aria-pressed="false" data-color-scheme="light">Light</button>
                      <button type="button" class="scheme-switcher__button" title="Auto" aria-label="◐" aria-pressed="false" data-color-scheme="auto">Auto</button>
                      <button type="button" class="scheme-switcher__button" title="Dark" aria-label="Dark" aria-pressed="false" data-color-scheme="dark">Dark</button>
                    </div>
                  </div>

                  <div class="nav-item d-none d-lg-flex" role="listitem">
                    <div id="tocVisibilityToggle" class="scheme-switcher mx-2" role="group" aria-label="Table of contents">
                      <button type="button" class="scheme-switcher__button" title="Show TOC" aria-label="Show TOC" aria-pressed="false" data-toc-visibility="show">☰ Show TOC</button>
                      <button type="button" class="scheme-switcher__button" title="Hide TOC" aria-label="Hide TOC" aria-pressed="false" data-toc-visibility="hide">Hide TOC</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </nav>

          <script>
            // Progressive enhancement: convert data-href buttons into navigable controls
            (function () {
              var buttons = document.querySelectorAll('.js-nav-button[data-href]');
              buttons.forEach(function (btn) {
                if (btn.dataset.enhanced) return; // idempotent
                btn.addEventListener('click', function () {
                  window.location = btn.getAttribute('data-href');
                });
                btn.addEventListener('keydown', function (e) {
                  if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    btn.click();
                  }
                });
                btn.dataset.enhanced = 'true';
              });
            })();
          </script>

