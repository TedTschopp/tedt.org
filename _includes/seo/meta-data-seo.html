	
<!-- legacy site.siteurl removed -->
<!--  full-page-url = {{full-page-url }} -->

{% assign this_page = page %}
{% assign page_layout = this_page.layout %}
{% if this_page.title == null or this_page.title == empty or this_page.title == '' %}
  {% if page_layout == 'micropubpost' and this_page.mf-checkin and this_page.mf-checkin[0] %}
    {% assign this_page_title = 'Checked Into ' | append: this_page.mf-checkin[0].properties.name[0] %}
  {% else %}
    {% assign this_page_title = site.title | default: 'Title: NA' %}
  {% endif %}
{% else %}
  {% assign this_page_title = this_page.title %}
{% endif %}

	<title>{{ this_page_title }}</title>
  <!-- TODO: Add Multiple Authors -->
  <meta name="author" content="{{ site.givenname }} {{ site.familyname }}">
  <link rel="author" href="{{site.url}}/humans.txt">
  <link rel="copyright" href="{{site.url}}/Copyright/">
  <link rel="canonical" href="{{ page.url | relative_url | absolute_url }}" />

  <!-- Mastodon Meta Data-->
  <!-- TODO: move to configuration _config.yml once you figure out multiple accounts.  -->
  <meta name="fediverse:creator" content="@TedT@twit.social">
  <meta name="fediverse:creator" content="@Ted@tschopp.net">


{% comment %} Compute meta description precedence: page.summary > page.seo-description > page['seo-description'] > page.description > site.description; then fallback to generated excerpt/content if still blank. {% endcomment %}
{% assign meta_description = page.summary | default: page.seo-description | default: page['seo-description'] | default: page.description | default: site.description | to_s | strip %}
{% if meta_description == '' %}
  {% comment %}Fallback: derive from excerpt/content when explicit description absent.{% endcomment %}
  {% assign raw_excerpt = page.excerpt | default: page.content %}
  {% assign meta_description = raw_excerpt | strip_html | replace:'\n',' ' | replace:'\r',' ' %}
{% endif %}
{% comment %}
  Normalize description once (collapse whitespace, limit runaway length) then reuse.
  - meta_description_clean_160 for standard meta tag
  - meta_description_clean_300 for OG / Twitter
  Escaping done at point-of-use (attribute context) via | escape.
{% endcomment %}
{% capture _md_work %}{{ meta_description | strip_html | replace:'\n',' ' | replace:'\r',' ' | replace:'  ',' ' | replace:'  ',' ' | strip }}{% endcapture %}
{% assign meta_description_clean = _md_work | truncate: 500 %}
{% assign meta_description_clean_160 = meta_description_clean | truncate:160 %}
{% assign meta_description_clean_300 = meta_description_clean | truncate:300 %}
{%- comment -%}
  Final attribute-safe variants: explicitly replace any remaining raw double quotes
  BEFORE the Liquid escape filter (which covers &, <, >, ") to guard against edge
  cases where upstream content reintroduces quotes post-processing. The replace
  is idempotent when combined with escape and ensures HTMLProofer doesn't see
  prematurely closed attributes.
{%- endcomment -%}
{%- comment -%}
  Some pages trigger HTMLProofer/Nokogiri attribute parsing errors when a raw
  quote appears in very long descriptions even after entity encoding. As a
  defensive measure, strip double quotes entirely (rather than encode them)
  in the attribute variants. This trades exact fidelity for robust markup.
{%- endcomment -%}
{%- comment -%}Initial quote stripping (straight quotes only) expanded to handle curly quotes and &quot; entities for stubborn parse errors{%- endcomment -%}
{% assign meta_description_attr_160 = meta_description_clean_160
  | replace: '"', ''
  | replace: '“', ''
  | replace: '”', ''
  | replace: '&quot;', '' %}
{% assign meta_description_attr_300 = meta_description_clean_300
  | replace: '"', ''
  | replace: '“', ''
  | replace: '”', ''
  | replace: '&quot;', '' %}
<!-- DIAG meta160: {{ meta_description_clean_160 | escape }} | stripped: {{ meta_description_attr_160 | escape }} -->
<!-- DIAG meta300: {{ meta_description_clean_300 | escape }} | stripped: {{ meta_description_attr_300 | escape }} -->
<meta name="description" content="{{ meta_description_attr_160 | escape }}">
<meta name="abstract" content="{{ site.name }}">

  {% if page.keywords %}
      <meta name="keywords" content="{{ page.keywords }}">
  {% else %}
      <meta name="keywords" content="{{ site.keywords | join: ', ' }}">
  {% endif %}

{% comment %} Open Graph logic unified {% endcomment %}
{% assign raw_page_image = page.image %}
{% if raw_page_image %}
  {% if raw_page_image contains '://' %}
    {% assign og_image_url = raw_page_image %}
  {% else %}
    {% assign og_image_url = raw_page_image | relative_url | absolute_url %}
  {% endif %}
{% else %}
  {% assign og_image_fallback = site.title_image | default: '/img/home/logo-Tschopp.webp' %}
  {% if og_image_fallback contains '://' %}
    {% assign og_image_url = og_image_fallback %}
  {% else %}
    {% assign og_image_url = og_image_fallback | relative_url | absolute_url %}
  {% endif %}
{% endif %}
<meta property="og:image" content="{{ og_image_url }}">
<meta property="og:image:alt" content="{{ page['image-alt'] | default: page.title | default: site.name | escape }}">
{% if page.image_width and page.image_height %}
  <meta property="og:image:width" content="{{ page.image_width }}">
  <meta property="og:image:height" content="{{ page.image_height }}">
  <meta name="twitter:image:width" content="{{ page.image_width }}">
  <meta name="twitter:image:height" content="{{ page.image_height }}">
{% endif %}
<meta property="og:site_name" content="{{ site.name }}">
{% if full-page-url == home-page-url %}
  <meta property="og:title" content="{{ this_page_title }}">
  {%- comment -%}Use pre-sanitized description variant to ensure any quotes in site.description are safely encoded just like other pages.{%- endcomment -%}
  <meta property="og:description" content="{{ meta_description_attr_300 | escape }}"><!-- desc-sanitizer-v2 -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ home-page-url }}">
{% else %}
  <meta property="og:title" content="{{ this_page_title }} - {{ site.name }}">
  <meta property="og:description" content="{{ meta_description_attr_300 | escape }}"><!-- desc-sanitizer-v2 -->
  <meta property="og:type" content="article">
  <meta property="og:url" content="{{ page.url | relative_url | absolute_url }}">
{% endif %}
<meta property="og:locale" content="en_US">
{% if site.facebook_app_id %}<meta property="fb:app_id" content="{{ site.facebook_app_id }}">{% endif %}


{%- comment -%}
Twitter Card Metadata (merged from twitter-card-metadata.html)
Order: site, creator, title, description, image, url.
Description precedence: page.summary > page.seo-description > page.description > site.description
{%- endcomment -%}
{% assign twitter_description = page.summary | default: meta_description_clean_300 %}
<meta name="twitter:site" content="@{{ site.twitter_username }}">
{% if page.author and page.author.twitter %}
  <meta name="twitter:creator" content="@{{ page.author.twitter }}">
{% elsif site.author and site.author.twitter %}
  <meta name="twitter:creator" content="@{{ site.author.twitter }}">
{% endif %}
<meta name="twitter:title" content="{{ this_page_title }}">
{%- assign twitter_description_sanitized = twitter_description
  | replace: '"', ''
  | replace: '“', ''
  | replace: '”', ''
  | replace: '&quot;', ''
-%}
<!-- DIAG twitter: raw {{ twitter_description | escape }} | stripped {{ twitter_description_sanitized | escape }} -->
<meta name="twitter:description" content="{{ twitter_description_sanitized | strip | truncate:300 | escape }}">
{% assign twitter_raw_img = page.image | default: site.title_image %}
{% if twitter_raw_img %}
  {% if twitter_raw_img contains '://' %}
    {% assign twitter_image_url = twitter_raw_img %}
  {% else %}
    {% assign twitter_image_url = twitter_raw_img | relative_url | absolute_url %}
  {% endif %}
  {% if page.image %}
    <meta name="twitter:card" content="summary_large_image">
  {% else %}
    <meta name="twitter:card" content="summary">
  {% endif %}
  <meta name="twitter:image" content="{{ twitter_image_url }}">
  <meta name="twitter:image:alt" content="{{ page['image-alt'] | default: site['title-image-alt'] | default: this_page_title | escape }}">
{% endif %}
{% if page.url %}<meta name="twitter:url" content="{{ page.url | relative_url | absolute_url }}">{% endif %}

{%- comment -%}
Article-specific meta (Open Graph): published, modified, section, tags.
{%- endcomment -%}
{% if page.date %}
  <meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}">
{% endif %}
{% if page.update %}
  <meta property="article:modified_time" content="{{ page.update | date_to_xmlschema }}">
{% endif %}
{% if page.categories %}
  {% assign primary_section = page.categories | first %}
  {% if primary_section %}<meta property="article:section" content="{{ primary_section }}">{% endif %}
{% endif %}
{% if page.tags %}
  {% for t in page.tags limit:12 %}<meta property="article:tag" content="{{ t }}">{% endfor %}
{% endif %}

{%- comment -%}
JSON-LD Article / WebSite structured data.
If it's the homepage treat as WebSite only; else add Article object.
{%- endcomment -%}
{% assign is_home = full-page-url == home-page-url %}
{% assign breadcrumb_position = 1 %}
{% assign breadcrumb_items = '' %}
{% if page.categories and page.categories != empty %}
  {% assign first_cat = page.categories | first %}
  {% capture _crumb_slug %}{% include utility/map-category-to-registry.html key=first_cat %}{% endcapture %}
  {% assign _crumb_slug = _crumb_slug | strip %}
  {% if _crumb_slug == '' %}{% assign _crumb_slug = first_cat | slugify %}{% endif %}
  {% assign _crumb_entry = site.data.category_registry[_crumb_slug] %}
  {% if _crumb_entry and _crumb_entry.category_home_page %}
    {% assign _crumb_href = _crumb_entry.category_home_page %}
  {% else %}
    {% assign _crumb_href = '/category/' | append: _crumb_slug | append: '/' %}
  {% endif %}
  {% capture breadcrumb_items %}
    {
      "@type": "ListItem",
      "position": 1,
      "name": {{ first_cat | jsonify }},
      "item": "{{ site.url }}{{ _crumb_href }}"
    }
  {% endcapture %}
  {% assign breadcrumb_position = breadcrumb_position | plus: 1 %}
{% endif %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  {% if is_home %}
  "@type": "WebSite",
  "url": "{{ home-page-url }}",
  "name": "{{ site.title | escape }}",
  "description": {{ meta_description_attr_300 | jsonify }},
  "publisher": {"@type":"Person","name":"{{ site.givenname }} {{ site.familyname }}"}
  {% else %}
  "@graph": [
    {
      "@type": "WebSite",
      "url": "{{ home-page-url }}",
      "name": "{{ site.title | escape }}",
      "publisher": {"@type":"Person","name":"{{ site.givenname }} {{ site.familyname }}"}
    },
    {
      "@type": "Article",
      "headline": {{ this_page_title | jsonify }},
  "description": {{ meta_description_attr_300 | jsonify }},
      "url": "{{ page.url | relative_url | absolute_url }}",
      {% if og_image_url %}"image": ["{{ og_image_url }}"],{% endif %}
      {% if page.date %}"datePublished": "{{ page.date | date_to_xmlschema }}",{% endif %}
      {% if page.update %}"dateModified": "{{ page.update | date_to_xmlschema }}",{% endif %}
      "author": {"@type":"Person","name":"{{ site.givenname }} {{ site.familyname }}"},
      "publisher": {"@type":"Person","name":"{{ site.givenname }} {{ site.familyname }}"},
      {% if page.tags %}"keywords": {{ page.tags | join: ', ' | jsonify }}, {% endif %}
      {% if page.categories %}"articleSection": {{ page.categories | first | jsonify }},{% endif %}
      "mainEntityOfPage": {"@type":"WebPage","@id":"{{ page.url | relative_url | absolute_url }}"}
    }
    {% if breadcrumb_items != '' %},
    {
      "@type": "BreadcrumbList",
      "itemListElement": [ {{ breadcrumb_items }} ]
    }
    {% endif %}
  ]
  {% endif %}
}
</script>

    <!-- Favicon Meta Tags.  -->
  <link rel="shortcut icon" href="{{ site.url }}/img/favicon.ico">
  <link rel="icon" type="image/png" href="{{ site.url }}/img/favicon-196x196.webp" sizes="196x196" />
  <link rel="icon" type="image/png" href="{{ site.url }}/img/favicon-96x96.webp" sizes="96x96" />
  <link rel="icon" type="image/png" href="{{ site.url }}/img/favicon-32x32.webp" sizes="32x32" />
  <link rel="icon" type="image/png" href="{{ site.url }}/img/favicon-16x16.webp" sizes="16x16" />
  <link rel="icon" type="image/png" href="{{ site.url }}/img/favicon-128.webp" sizes="128x128" />


    <!-- Apple iOS Settings. -->
    <!--Sets whether a web application runs in full-screen mode. -->
    <meta name="apple-mobile-web-app-capable"          content="yes">
    <!-- Color of the status bar -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!-- Web App Name for the Shortcut -->
    <meta name="apple-mobile-web-app-title"            content="{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}">
    <!-- Do Not Detect Phone Numbers -->
    <meta name="format-detection"                      content="telephone=no">

    <!-- iPhone icons -->
  <!-- Apple touch icons (all inside head) -->
  <link rel="apple-touch-icon" sizes="57x57" href="{{ site.url }}/img/apple-touch-icon-57x57.webp" />
  <link rel="apple-touch-icon" sizes="114x114" href="{{ site.url }}/img/apple-touch-icon-114x114.webp" />
  <link rel="apple-touch-icon" sizes="72x72" href="{{ site.url }}/img/apple-touch-icon-72x72.webp" />
  <link rel="apple-touch-icon" sizes="144x144" href="{{ site.url }}/img/apple-touch-icon-144x144.webp" />
  <link rel="apple-touch-icon" sizes="60x60" href="{{ site.url }}/img/apple-touch-icon-60x60.webp" />
  <link rel="apple-touch-icon" sizes="120x120" href="{{ site.url }}/img/apple-touch-icon-120x120.webp" />
  <link rel="apple-touch-icon" sizes="76x76" href="{{ site.url }}/img/apple-touch-icon-76x76.webp" />
  <link rel="apple-touch-icon" sizes="152x152" href="{{ site.url }}/img/apple-touch-icon-152x152.webp" />


    <meta name="application-name" content="&nbsp;"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="{{ site.url }}/img/mstile-144x144.webp" />
    <meta name="msapplication-square70x70logo" content="{{ site.url }}/img/mstile-70x70.webp" />
    <meta name="msapplication-square150x150logo" content="{{ site.url }}/img/mstile-150x150.webp" />
    <meta name="msapplication-wide310x150logo" content="{{ site.url }}/img/mstile-310x150.webp" />
    <meta name="msapplication-square310x310logo" content="{{ site.url }}/img/mstile-310x310.webp" />

    <!-- Google Chrome. -->

    <meta name="google" value="notranslate">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Pinterest. -->
    <!-- Prevents sharing of content by Pinterest users. -->
    <!-- <meta name="pinterest" content="nopin" description="Sorry, you can't save from my website!"> -->
    <!-- Pinterest Verify -->
    <meta name="p:domain_verify" content="{{ site.pinterest_domain_verify }}"/>

{% comment %}

<!-- Begin Jekyll SEO tag v{{ seo_tag.version }} -->
{% if seo_tag.title %}
  <title>{{ seo_tag.title }}</title>
{% endif %}

<meta name="generator" content="Jekyll v{{ jekyll.version }}" />

{% if seo_tag.page_title %}
  <meta property="og:title" content="{{ seo_tag.page_title }}" />
{% endif %}

{% if seo_tag.author.name %}
  <meta name="author" content="{{ seo_tag.author.name }}" />
{% endif %}

{% if seo_tag.page_locale %}
	<meta property="og:locale" content="{{ seo_tag.page_locale }}" />
{% endif %}

{% if seo_tag.description %}
  <meta name="description" content="{{ seo_tag.description }}" />
  <meta property="og:description" content="{{ seo_tag.description }}" />
  <meta property="twitter:description" content="{{ seo_tag.description }}" />
{% endif %}

{% if site.url %}
  <link rel="canonical" href="{{ seo_tag.canonical_url }}" />
  <meta property="og:url" content="{{ seo_tag.canonical_url }}" />
{% endif %}

{% if seo_tag.site_title %}
  <meta property="og:site_name" content="{{ seo_tag.site_title }}" />
{% endif %}

{% if seo_tag.image %}
  <meta property="og:image" content="{{ seo_tag.image.path }}" />
  {% if seo_tag.image.height %}
    <meta property="og:image:height" content="{{ seo_tag.image.height }}" />
  {% endif %}
  {% if seo_tag.image.width %}
    <meta property="og:image:width" content="{{ seo_tag.image.width }}" />
  {% endif %}
  {% if seo_tag.image.alt %}
    <meta property="og:image:alt" content="{{ seo_tag.image.alt }}" />
  {% endif %}
{% endif %}

{% if page.date %}
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}" />
{% else %}
  <meta property="og:type" content="website" />
{% endif %}

{% if paginator.previous_page %}
  <link rel="prev" href="{{ paginator.previous_page_path | absolute_url }}" />
{% endif %}
{% if paginator.next_page %}
  <link rel="next" href="{{ paginator.next_page_path | absolute_url }}" />
{% endif %}

{% if seo_tag.image %}
  <meta name="twitter:card" content="{{ page.twitter.card | default: site.twitter.card | default: "summary_large_image" }}" />
  <meta property="twitter:image" content="{{ seo_tag.image.path }}" />
{% else %}
  <meta name="twitter:card" content="summary" />
{% endif %}

{% if seo_tag.image.alt %}
  <meta name="twitter:image:alt" content="{{ seo_tag.image.alt }}" />
{% endif %}

{% if seo_tag.page_title %}
  <meta property="twitter:title" content="{{ seo_tag.page_title }}" />
{% endif %}

{% if site.twitter %}
  <meta name="twitter:site" content="@{{ site.twitter.username | remove:'@' }}" />

  {% if seo_tag.author.twitter %}
    <meta name="twitter:creator" content="@{{ seo_tag.author.twitter | remove:'@' }}" />
  {% endif %}
{% endif %}

{% if site.facebook %}
  {% if site.facebook.admins %}
    <meta property="fb:admins" content="{{ site.facebook.admins }}" />
  {% endif %}

  {% if site.facebook.publisher %}
    <meta property="article:publisher" content="{{ site.facebook.publisher }}" />
  {% endif %}

  {% if site.facebook.app_id %}
    <meta property="fb:app_id" content="{{ site.facebook.app_id }}" />
  {% endif %}
{% endif %}

{% if site.webmaster_verifications %}
  {% if site.webmaster_verifications.google %}
    <meta name="google-site-verification" content="{{ site.webmaster_verifications.google }}" />
  {% endif %}

  {% if site.webmaster_verifications.bing %}
    <meta name="msvalidate.01" content="{{ site.webmaster_verifications.bing }}" />
  {% endif %}

  {% if site.webmaster_verifications.alexa %}
    <meta name="alexaVerifyID" content="{{ site.webmaster_verifications.alexa }}" />
  {% endif %}

  {% if site.webmaster_verifications.yandex %}
    <meta name="yandex-verification" content="{{ site.webmaster_verifications.yandex }}" />
  {% endif %}

  {% if site.webmaster_verifications.baidu %}
    <meta name="baidu-site-verification" content="{{ site.webmaster_verifications.baidu }}" />
  {% endif %}

  {% if site.webmaster_verifications.facebook %}
    <meta name="facebook-domain-verification" content="{{ site.webmaster_verifications.facebook }}" />
  {% endif %}
{% elsif site.google_site_verification %}
  <meta name="google-site-verification" content="{{ site.google_site_verification }}" />
{% endif %}

<script type="application/ld+json">
  {{ seo_tag.json_ld | jsonify }}
</script>

<!-- End Jekyll SEO tag -->
{% endcomment %}