    {%- comment -%}
        Removed external Font Awesome kit (403 errors in CI & Playwright).  
        Fallback: lightweight Unicode/CSS pseudo-element mappings added in css-fa-fallback include.
        Rationale: Eliminate external dependency noise while preserving layout & decorative icons (all aria-hidden).
    {%- endcomment -%}

    <!-- jQuery - Load early to ensure availability -->
    {% include assets/js-jquery.html %}

    {% capture __mathjax_flag_scripts %}{{ page.mathjax | default: '' }}{% endcapture %}
    {% assign __mathjax_flag_scripts = __mathjax_flag_scripts | strip | downcase %}
    {%- comment -%}
        MathJax loading logic consolidated: legacy v2 script removed.
        Rationale: post layout already conditionally includes `assets/mathjax.html` (MathJax v3 + config)
        when `page.math` or `page.mathjax` is truthy. Loading v2 here caused duplicate engine
        initialization and prevented reliable rendering. See accessibility & performance guidelines.
    {%- endcomment -%}
    {# Intentionally no direct MathJax script tag here; rely on centralized include in layout. #}

    {% if mf-location == true %}
    <!-- Leaflet Open Street Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
      integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
      crossorigin=""/>
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
      integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
      crossorigin=""></script>
    <style>
      #mapid { height: 400px; }
    </style>
    {% endif %}

    <!-- Webmentions code -->
    <script src="/js/webmention.js/static/webmention.js"  data-comments-are-reactions="true" async></script>

    <!-- Start of Rough Notation Code --->
    {% include assets/rough-notation.html %}

    <!-- Winerlinks code-->
    <script src="/js/winerlinks.js" async></script>

    <!-- blurhash - load conditionally to avoid module errors -->
    <script>
        // Only load blurhash if we're in a proper browser context
        try {
            // Check if we're in a browser context and blurhash isn't already loaded
            if (typeof window !== 'undefined' && typeof window.BlurHash === 'undefined') {
                // Store original values
                const originalModule = window.module;
                const originalExports = window.exports;
                
                // Create a temporary module environment for the library
                window.module = { exports: {} };
                window.exports = window.module.exports;
                
                // Load the script dynamically
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/blurhash@2.0.5/dist/index.min.js';
                script.async = true;
                script.onload = function() {
                    // Extract the blurhash functions from module.exports and make them globally available
                    if (window.module && window.module.exports) {
                        window.BlurHash = window.module.exports;
                        // Also expose individual functions globally for easier access
                        if (window.module.exports.decode) {
                            window.decode = window.module.exports.decode;
                        }
                        if (window.module.exports.encode) {
                            window.encode = window.module.exports.encode;
                        }
                    }
                    
                    // Restore original values
                    if (originalModule !== undefined) {
                        window.module = originalModule;
                    } else {
                        delete window.module;
                    }
                    if (originalExports !== undefined) {
                        window.exports = originalExports;
                    } else {
                        delete window.exports;
                    }
                };
                script.onerror = function() {
                    console.warn('BlurHash library failed to load - image lazy loading may not work optimally');
                    // Restore original values on error too
                    if (originalModule !== undefined) {
                        window.module = originalModule;
                    } else {
                        delete window.module;
                    }
                    if (originalExports !== undefined) {
                        window.exports = originalExports;
                    } else {
                        delete window.exports;
                    }
                };
                document.head.appendChild(script);
            }
        } catch (e) {
            console.warn('BlurHash loading skipped due to compatibility issues:', e);
        }
    </script>

    <!-- Start Clarity Code -->
    {% include analytics/clarity.html %}

    <!-- Start Google Analytics-->
    {% include analytics/google-analytics.html %}



{% comment %}    
    <!-- Start of Async Drift Code --->
    <!-- include js-drift.html --->


    <!-- Start MailChip Code -->
    <!-- include js-mailchimp.html --->

{% endcomment %}    
