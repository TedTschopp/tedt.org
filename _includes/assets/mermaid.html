<!-- Mermaid.js (loaded only when page.mermaid flag set or code fences detected via manual flag) -->
<script defer src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function(){
    if (!window.mermaid) return;
    mermaid.initialize({ startOnLoad: true, securityLevel: 'strict', theme: (document.documentElement.getAttribute('data-bs-theme')==='dark'?'dark':'default') });
  });
</script>
